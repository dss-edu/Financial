<!DOCTYPE html>
{% extends 'temps/base.html' %}
{% load static %}

{% block title %}
{{ school_name }}
{% endblock %}

{% block stylesheet %}
<link rel="stylesheet" href="{% static 'css/charts.css' %}">

<!--  Material icons -->
<link rel="stylesheet"
href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@48,400,1,0" />
{% endblock %}

{% block body %}
<div id="content-wrapper">

<nav class="navbar navbar-expand navbar-dark bg-dark ">

    <a class="navbar-brand mr-1 text-primary " href="" ></a>
    

    <!-- Navbar Search -->
    <form class="d-none d-md-inline-block form-inline ml-auto mr-0 mr-md-3 my-2 my-md-0">
      
    </form>
    <a class="navbar-brand mr-1 text-primary " href="https://app.powerbi.com/groups/031634b4-01f7-4358-856c-e48f6f5fcaca/reports/61085bf2-1355-4ac4-adfd-c41d2ede3d1a/ReportSection3e1e5b586b7d627ce437?experience=power-bi" ><i class="fas fa-file-powerpoint"></i></a>
    <!-- Navbar -->
    &nbsp;
    &nbsp;
    &nbsp;
    &nbsp;
    <a class="navbar-brand mr-1 text-primary " href="/profit-loss/{{ school }}" ><i class="fas fa-table"></i></a>
    
      
  

</nav>
&nbsp;
&nbsp;
&nbsp;
&nbsp;
{% comment %} <div style="display: flex; flex-direction: column; align-items: center; text-align: center;">
  <h1>Total Revenue</h1>
  <div id="totalrevenue" style="width: 100%; height: 400px;"></div>
</div>
        

<div style="display: flex; flex-direction: column; align-items: center; text-align: center;">
  <h1>Total Expense</h1>
  <div id="totalfirst" style="width: 100%; height: 400px;"></div>
</div> {% endcomment %}
        

<div class="container">
  <div class="insights " >
      <!--START rating-->
      <div class="rating">
          <div class="top">
              <h1>Financial Perfomance Dashboard</h1>
           
          </div><!--end top-->
         <div id="chartdiv"></div>
         <h1 id="formattedTotal"></h1>
      </div>
      <script>
        var ytd_total = "{{totals.ytd_total_revenue}}";
        var formattedTotal = '$' + parseInt(ytd_total).toLocaleString() + " YTD";
      
        // Get the div element where you want to display the formatted total
        var formattedTotalDiv = document.getElementById("formattedTotal");
      
        // Update the content of the div with the formatted total
        formattedTotalDiv.textContent = formattedTotal;
      </script>
      <!--END rating-->

      <div class="ratios">
          
      </div><!--END ratios-->
  </div> <!--END insights-->

  <div class="insights">

      <!--START totalrevenue -->
      <div class="net-income">
          <div>
              
              <h2>Revenue</h2>
          </div>
          <div id="totalrevenue" style="width: 100%; height: 400px;">
          </div>
      </div><!--END totalrevenue-->
      <div id="totalfirst" style="width: 100%; height: 400px;">
          <h2>Expenses</h2>
         


      </div><!--END total first-->

  </div> <!--END insights-->
</div> 


</div>



{% endblock %}
{% block javascript %}

<!--AM Charts-->
<script src="https://cdn.amcharts.com/lib/5/index.js"></script>
<script src="https://cdn.amcharts.com/lib/5/xy.js"></script>
<script src="https://cdn.amcharts.com/lib/5/themes/Animated.js"></script>
<script src="https://cdn.amcharts.com/lib/5/locales/de_DE.js"></script>
<script src="https://cdn.amcharts.com/lib/5/geodata/germanyLow.js"></script>
<script src="https://cdn.amcharts.com/lib/5/fonts/notosans-sc.js"></script>
<script src="https://cdn.amcharts.com/lib/5/percent.js"></script>

<!-- my scripts-->


<script>
  am5.ready(function() {

    // Create root element
    // https://www.amcharts.com/docs/v5/getting-started/#Root_element
    var root = am5.Root.new("chartdiv");
    
    // Set themes
    // https://www.amcharts.com/docs/v5/concepts/themes/
    root.setThemes([
      am5themes_Animated.new(root)
    ]);
    
    // Create chart
    // https://www.amcharts.com/docs/v5/charts/percent-charts/pie-chart/
    // start and end angle must be set both for chart and series
    var chart = root.container.children.push(am5percent.PieChart.new(root, {
      startAngle: 180,
      endAngle: 360,
      layout: root.verticalLayout,
      innerRadius: am5.percent(50)
    }));
    
    // Create series
    // https://www.amcharts.com/docs/v5/charts/percent-charts/pie-chart/#Series
    // start and end angle must be set both for chart and series
    var series = chart.series.push(am5percent.PieSeries.new(root, {
      startAngle: 180,
      endAngle: 360,
      valueField: "total",
      categoryField: "total",
      alignLabels: false
    }));
    
    series.states.create("hidden", {
      startAngle: 180,
      endAngle: 180
    });
    
    series.slices.template.setAll({
      cornerRadius: 5
    });
    
    series.ticks.template.setAll({
      forceHidden: true
    });
    
    // Set data
    // https://www.amcharts.com/docs/v5/charts/percent-charts/pie-chart/#Setting_data
    var ytd_data = {{ totals.ytd_total_revenue|safe }}; // Your data goes here
    var chartData = [];
   
    var monthName = "se";


    
      chartData.push({
        month: monthName,
        total: ytd_data
      });


    series.data.setAll(chartData);
    
    series.appear(1000, 100);
    
    }); // end am5.ready()
</script>
<script>
  
  am5.ready(function() {
    var root = am5.Root.new("totalrevenue");
    
    
    // Set themes
    // https://www.amcharts.com/docs/v5/concepts/themes/
    root.setThemes([
      am5themes_Animated.new(root)
    ]);
    
    
    

// Create chart
// https://www.amcharts.com/docs/v5/charts/xy-chart/
var chart = root.container.children.push(am5xy.XYChart.new(root, {
  panX: false,
  panY: false,
  wheelX: "panX",
  wheelY: "zoomX",
  layout: root.verticalLayout
}));

// Add scrollbar
// https://www.amcharts.com/docs/v5/charts/xy-chart/scrollbars/
chart.set("scrollbarX", am5.Scrollbar.new(root, {
  orientation: "horizontal"
}));



var total_lr = {{ totals.total_lr|safe }};
var total_spr = {{ totals.total_spr|safe }};
var total_fpr = {{ totals.total_fpr|safe }};

var revenueProperties = {
  "Local": total_lr,
  "State": total_spr,
  "Federal": total_fpr,
};

var dataCharts = [];

var monthNames = {
  "01": "January",
  "02": "February",
  "03": "March",
  "04": "April",
  "05": "May",
  "06": "June",
  "07": "July",
  "08": "August",
  "09": "September",
  "10": "October",
  "11": "November",
  "12": "December"
};

for (var month in total_lr) {
  var monthName = monthNames[month] || month; // Use the month name from the mapping, or the numeric value if not found
  var entry = {
    month: monthName
  };

  for (var revenueType in revenueProperties) {
    entry["revenue" + revenueType] = revenueProperties[revenueType][month] * -1;
  }

  dataCharts.push(entry);
}






// Create axes
// https://www.amcharts.com/docs/v5/charts/xy-chart/axes/
var xRenderer = am5xy.AxisRendererX.new(root, { minGridDistance: 30 });
xRenderer.labels.template.setAll({
  rotation: -90,
  centerY: am5.p50,
  centerX: am5.p100,
  paddingRight: 15
});
var xAxis = chart.xAxes.push(am5xy.CategoryAxis.new(root, {
  maxDeviation: 0.3,
  categoryField: "month",
  renderer: xRenderer,
  tooltip: am5.Tooltip.new(root, {})
}));

xRenderer.grid.template.setAll({
  location: 1
})

xAxis.data.setAll(dataCharts);

var yAxis = chart.yAxes.push(am5xy.ValueAxis.new(root, {
  maxDeviation: 0.3,
  min: 0,
  renderer: am5xy.AxisRendererY.new(root, {
    strokeOpacity: 0.1
  })
}));


// Add legend
// https://www.amcharts.com/docs/v5/charts/xy-chart/legend-xy-series/
var legend = chart.children.push(am5.Legend.new(root, {
  centerX: am5.p50,
  x: am5.p50
}));


// Add series
// https://www.amcharts.com/docs/v5/charts/xy-chart/series/
function makeSeries(name, fieldName) {
  var series = chart.series.push(am5xy.ColumnSeries.new(root, {
    name: name,
    stacked: true,
    xAxis: xAxis,
    yAxis: yAxis,
    sequencedInterpolation: true,
    valueYField: fieldName,
    categoryXField: "month"
  }));

  series.columns.template.setAll({
    tooltipText: "{name}, {categoryX}: {valueY}",
    tooltipY: am5.percent(10)
  });
  series.data.setAll(dataCharts);

  // Make stuff animate on load
  // https://www.amcharts.com/docs/v5/concepts/animations/
  series.appear();

  series.bullets.push(function() {
    return am5.Bullet.new(root, {
      sprite: am5.Label.new(root, {
        text: "{valueY}",
        fontSize: 8,
        fill: root.interfaceColors.get("alternativeText"),
        centerY: am5.p50,
        centerX: am5.p50,
        populateText: true
      })
    });
  });

  legend.data.push(series);
}

makeSeries("Local Revenue", "revenueLocal");
makeSeries("State Program Revenue", "revenueState");
makeSeries("Federal Program Revenue", "revenueFederal");



// Make stuff animate on load
// https://www.amcharts.com/docs/v5/concepts/animations/
chart.appear(1000, 100);

}); // end am5.ready()

  
</script>

<script>
  
  am5.ready(function() {


    // Create root element
    // https://www.amcharts.com/docs/v5/getting-started/#Root_element
    var root = am5.Root.new("totalfirst");
    
    // Set themes
// https://www.amcharts.com/docs/v5/concepts/themes/
root.setThemes([
  am5themes_Animated.new(root),

]);


// Create chart
// https://www.amcharts.com/docs/v5/charts/xy-chart/
var chart = root.container.children.push(am5xy.XYChart.new(root, {
  panX: false,
  panY: false,
  wheelX: "panX",
  wheelY: "zoomX",
  layout: root.verticalLayout
}));

// Add scrollbar
// https://www.amcharts.com/docs/v5/charts/xy-chart/scrollbars/
chart.set("scrollbarX", am5.Scrollbar.new(root, {
  orientation: "horizontal"
}));



var expense6100 = {{ totals.total_EOC_pc|safe }};
var expense6200 = {{ totals.total_EOC_pcs|safe }};
var expense6300 = {{ totals.total_EOC_sm|safe }};
var expense6400 = {{ totals.total_EOC_ooe|safe }};
var expense6449 = {{ totals.dna_total_months|safe }};
var expense6500 = {{ totals.total_EOC_te|safe }};
var expenseProperties = {
  "6100": expense6100,
  "6200": expense6200,
  "6300": expense6300,
  "6400": expense6400,
  "6449": expense6449,
  "6500": expense6500
};

var dataChart = [];

var monthNames = {
  "01": "January",
  "02": "February",
  "03": "March",
  "04": "April",
  "05": "May",
  "06": "June",
  "07": "July",
  "08": "August",
  "09": "September",
  "10": "October",
  "11": "November",
  "12": "December"
};

for (var month in expense6100) {
  var monthName = monthNames[month] || month; // Use the month name from the mapping, or the numeric value if not found
  var entry = {
    month: monthName
  };

  for (var expenseType in expenseProperties) {
    entry["expense" + expenseType] = expenseProperties[expenseType][month];
  }

  dataChart.push(entry);
}

console.log(dataChart);




// Create axes
// https://www.amcharts.com/docs/v5/charts/xy-chart/axes/
var xRenderer = am5xy.AxisRendererX.new(root, { minGridDistance: 30 });
xRenderer.labels.template.setAll({
  rotation: -90,
  centerY: am5.p50,
  centerX: am5.p100,
  paddingRight: 15
});
var xAxis = chart.xAxes.push(am5xy.CategoryAxis.new(root, {
  maxDeviation: 0.3,
  categoryField: "month",
  renderer: xRenderer,
  tooltip: am5.Tooltip.new(root, {})
}));

xRenderer.grid.template.setAll({
  location: 1
})

xAxis.data.setAll(dataChart);

var yAxis = chart.yAxes.push(am5xy.ValueAxis.new(root, {
  maxDeviation: 0.3,
  min: 0,
  renderer: am5xy.AxisRendererY.new(root, {
    strokeOpacity: 0.1
  })
}));


// Add legend
// https://www.amcharts.com/docs/v5/charts/xy-chart/legend-xy-series/
var legend = chart.children.push(am5.Legend.new(root, {
  centerX: am5.p50,
  x: am5.p50
}));


// Add series
// https://www.amcharts.com/docs/v5/charts/xy-chart/series/
function makeSeries(name, fieldName) {
  var series = chart.series.push(am5xy.ColumnSeries.new(root, {
    name: name,
    stacked: true,
    xAxis: xAxis,
    yAxis: yAxis,
    sequencedInterpolation: true,
    valueYField: fieldName,
    categoryXField: "month"
  }));

  series.columns.template.setAll({
    tooltipText: "{name}, {categoryX}: {valueY}",
    tooltipY: am5.percent(10)
  });
  series.data.setAll(dataChart);

  // Make stuff animate on load
  // https://www.amcharts.com/docs/v5/concepts/animations/
  series.appear();

  series.bullets.push(function() {
    return am5.Bullet.new(root, {
      sprite: am5.Label.new(root, {
        text: "{valueY}",
        fontSize: 8,
        fill: root.interfaceColors.get("alternativeText"),
        centerY: am5.p50,
        centerX: am5.p50,
        populateText: true
      })
    });
  });

  legend.data.push(series);
}

makeSeries("6100 - Payroll and Benefits", "expense6100");
makeSeries("6200 - Professional and Contract Services", "expense6200");
makeSeries("6300 - Materials and Supplies", "expense6300");
makeSeries("6400 - Other Operating Costs", "expense6400");
makeSeries("6449 - Depreciation", "expense6449");
makeSeries("6500 - Debt Services", "expense6500");


// Make stuff animate on load
// https://www.amcharts.com/docs/v5/concepts/animations/
chart.appear(1000, 100);

}); // end am5.ready()

  
</script>
{% endblock %}
