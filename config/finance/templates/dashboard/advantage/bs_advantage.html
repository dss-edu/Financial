<!DOCTYPE html>
{% extends 'dashboard/advantage/base.html' %}

{% load static %}
<head>
  {% block stylesheet %}
  <style>
      
   
    td:first-child,
  td:nth-child(2) {
  width: 100px;
  }
  .right-align-td {
    text-align: right;
    padding-right: 250px;
  }
  .collapsed {
    display: none;
  }
  .modal-body {
    max-height: 2000px;
    max-width: 2000px;
    overflow-y: auto;
  }
  
  .modal-body thead {
    position: sticky;
    top: 0;
    background-color: #f9f9f9;
    z-index: 1;
  }
  .modal-footer {
    z-index: 2;
  }
  .width20{
    width: 20%;
  }
  .table-container {
    bottom: 0;
    width: 100%;
    max-height: calc(100vh - 150px); 
    overflow: auto;
  }

  
</style>
  {% endblock %}   
   
 

</head>
{% block body %}

 <div id="content-wrapper">
  
  <nav class="navbar navbar-expand navbar-dark bg-dark ">

    <a class="navbar-brand mr-1 text-primary " href="" ></a>
    

    <!-- Navbar Search -->
    <form class="d-none d-md-inline-block form-inline ml-auto mr-0 mr-md-3 my-2 my-md-0">
      
    </form>
    <a class="navbar-brand mr-1 text-primary " href="https://app.powerbi.com/groups/031634b4-01f7-4358-856c-e48f6f5fcaca/reports/61085bf2-1355-4ac4-adfd-c41d2ede3d1a/ReportSection3e1e5b586b7d627ce437?experience=power-bi" data-toggle="tooltip" title="POWERBI" target="_blank"><i class="fas fa-file-powerpoint"  ></i></a>
    <!-- Navbar -->
    &nbsp;
    &nbsp;
    &nbsp;
    &nbsp;
    <a class="navbar-brand mr-1 text-primary " href="{% url 'pl_advantagechart' %}" data-toggle="tooltip" title="CHART"><i class="fas fa-chart-bar" ></i></a>
    
    &nbsp;
    &nbsp;
    &nbsp;
    &nbsp;
    <a id="export-pdf-button" class="navbar-brand mr-1 text-primary " href="#" data-toggle="tooltip" title="PDF"><i class="fas fa-file-pdf"></i></a>
    
  

</nav>

<script>
  document.getElementById('export-pdf-button').addEventListener('click', function (event) {
  event.preventDefault(); 

    // Show the confirmation modal
  var confirmationModal = document.getElementById("confirmation-modal");
  var confirmYes = document.getElementById("confirm-yes");
  var confirmNo = document.getElementById("confirm-no");

  
  confirmYes.addEventListener("click", function () {
    var element = document.getElementById('data-table');
  var rows = element.getElementsByTagName('tr');
  for (var i = 0; i < rows.length; i++) {
    var cells = rows[i].getElementsByTagName('td');
    var headerCells = rows[i].getElementsByTagName('th');

    if (cells.length > 0) {
      rows[i].removeChild(cells[0]);
      
    }

    if (headerCells.length > 0) {
      rows[i].removeChild(headerCells[0]);
      
    }

  }

  
  expandColumns();
  for (var rowId = 1; rowId <= 100; rowId++) {
    expandRow(rowId);
  }

  var options = {
    margin: 2,
    filename: 'exported_table.pdf',
    image: { type: 'png', quality: 0.98 },
    html2canvas: { scale: 2 },
    jsPDF: { unit: 'mm', format: [600,600], orientation: 'portrait' },
  };

  confirmationModal.style.display = "none";
  html2pdf().set(options).from(element).save();
  
  });

  confirmNo.addEventListener("click", function () {
    var element = document.getElementById('data-table');
    hideRowsOnLoad();
    var options = {
      margin: 2,
      filename: 'exported_table.pdf',
      image: { type: 'png', quality: 0.98 },
      html2canvas: { scale: 2 },
      jsPDF: { unit: 'mm', format: [600,600], orientation: 'portrait' },
    };

    
  html2pdf().set(options).from(element).save();
  confirmationModal.style.display = "none";

  });
  
  confirmationModal.style.display = "block";
});

function expandRow(rowId) {
  for (var i = 0; i <= 100; i++) {
    var row = document.getElementById("row" + rowId + "-" + i);
    if (row) {
      row.style.display = "table-row";
    }
  }
}

function expandColumns() {
  var collapsedColumns = document.getElementsByClassName("collapsed");
  for (var i = 0; i < collapsedColumns.length; i++) {
    collapsedColumns[i].style.display = "table-cell";
  }
}


</script>
<div class="modal" id="confirmation-modal" tabindex="-1" role="dialog">
  <div class="modal-dialog" role="document">
    <div class="modal-content" style="height: 80%;">

      <div class="modal-body">
         <h4>Export Confirmation</h4>
        <p>Do you want the detailed view?</p>
      </div>
      <div class="modal-footer">
        <button type="button" id="confirm-yes" class="btn btn-primary">Yes</button>
        <button type="button" id="confirm-no" class="btn btn-secondary" data-dismiss="modal">No</button>
      </div>
    </div>
  </div>
</div>


<div class="modal" id="myModal">
  <div class="modal-dialog modal-dialog-centered" style="width: 80%; height: 80%; max-width: none; max-height: none;">
    <div class="modal-content" style="height: 80%;">
      <div class="modal-body" style="max-height: 80%; overflow-y: auto;">
        <!-- Modify the table to display the data from the viewgl function -->
        <table id="balancesheet-data-table" class="table table-hover">
          <thead>
            <tr>
            <th>fund</th>
            <th>func</th>
            <th>obj</th>
            <th>org</th>
            <th>fscl_yr</th>
            <th>pgm</th>
            
            <th>projDtl</th>
            <th>AcctDescr</th>
            <th>Number</th>
            <th>Date</th>
            <th>AcctPer</th>
         
            <th>Real</th>
            
            <th>Expend</th>
            <th>Bal</th>
            <th>WorkDescr</th>
            <th>Type</th>
            
            </tr>
          </thead>
          <tbody id="modal-table-body">
            <!-- The data from the viewgl function will be populated here -->
          </tbody>
        </table>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-danger" data-dismiss="modal">Close</button>
        <a id="export-pdf-button2" class="navbar-brand mr-1 text-primary " href="#" data-toggle="tooltip" title="PDF"><i class="fas fa-file-pdf"></i></a>
      </div>
    </div>
  </div>
</div>
  
<script>
  document.getElementById('export-pdf-button2').addEventListener('click', function (event) {
    event.preventDefault(); 

    var element = document.getElementById('balancesheet-data-table');

    var rows = element.getElementsByTagName('tr');
  for (var i = 0; i < rows.length; i++) {
    var cells = rows[i].getElementsByTagName('td');
    var buttons = rows[i].getElementsByTagName('button');
    
    if (cells.length > 0) {
      rows[i].removeChild(cells[0]);
    }

    // Remove the expand buttons
    if (buttons.length > 0) {
      rows[i].removeChild(buttons[0].parentNode);
    }
  }

    var options = {
      margin: 2,
      filename: 'exported_table.pdf',
      image: { type: 'png', quality: 0.98 },
      html2canvas: {  scale: 1, 
        scrollX: 0,
        scrollY: 0,},
      jsPDF: { unit: 'mm', format: [600,600], orientation: 'portrait' },
    };

   
    html2pdf().set(options).from(element).save();
  });
</script>


  <div class="table-container" >
<div id="json-response"></div>
<form  id="insert-row-form" action="{% url 'insert_bs_advantage' %}" method="POST">
  <div id="edit-container">
    <button id="edit-button" class="btn btn-sm btn-success" type="button" style=" float: right;">Edit</button>
</div>

<div id="cancel-container" style="display: none;">
  <button id="cancel-button" class="btn btn-sm btn-success" type="button" style=" float: right; margin-left: 10px;" >Cancel</button>
</div>

<div id="save-container" style="display: none;">
    <button id="save-button" class="btn btn-sm btn-success" style="float: right; margin-left: 10px; " >Save</button>
</div>

<script>
    document.getElementById("edit-button").addEventListener("click", function() {
        // Hide the "Edit" container
        document.getElementById("edit-container").style.display = "none";

        // Show the "Save" container
        document.getElementById("save-container").style.display = "block";
        document.getElementById("cancel-container").style.display = "block";
        
        
        
        var valueCells = document.querySelectorAll("[id^='value-cell-']");
        valueCells.forEach(function(cell) {
            cell.contentEditable = "true";
        });
        var deleteLinks = document.querySelectorAll("[id^='delete-container']");
        deleteLinks.forEach(function(link) {
            link.style.display = "block";
        });
        document.getElementById("add-row-button").style.display = "block";
        document.getElementById("add-row-button-capital-assets").style.display = "block";
        document.getElementById("add-row-button-CL").style.display = "block";
        document.getElementById("add-row-button-LTD").style.display = "block";
        
        
    });

    document.getElementById("cancel-button").addEventListener("click", function() {
        // Hide the "Save" container
        document.getElementById("save-container").style.display = "none";
        document.getElementById("cancel-container").style.display = "none";
        
    
        

        // Show the "Edit" container
        document.getElementById("edit-container").style.display = "block";
        var valueCells = document.querySelectorAll("[id^='value-cell-']");
        valueCells.forEach(function(cell) {
            cell.contentEditable = "false";
        });
        var deleteLinks = document.querySelectorAll("[id^='delete-container']");
        deleteLinks.forEach(function(link) {
            link.style.display = "none";
        });
        document.getElementById("add-row-button").style.display = "none";
        document.getElementById("add-row-button-capital-assets").style.display = "none";
        document.getElementById("add-row-button-CL").style.display = "none";
        document.getElementById("add-row-button-LTD").style.display = "none";
        
       
        
    });
</script>

  {% csrf_token %}
    <table id="data-table" class="table table-hover">
        <thead>
          <tr>
            <th></th>
           
         
            <th colspan="17" style="white-space: nowrap;">
              <h2 style="text-align: center;">ADVANTAGE ACADEMY</h2><br>
              <h2 style="text-align: center;">FY2022-2023 Statement of Activities as of {{last_month}}</h2><br>
            </th>
           
            
        </tr>
        <tr>
          <script>
            for (var i = 0; i <= 17; i++){
              if (i === 4 ) {
                document.write(`<th><button id="toggle-button" type="button" class="expand-button" onclick="toggleColumns(); hide17thColumn();" >+</button></th>`);
              }
              else if(i>=5 && i<=15){
                document.write(`<td  class="collapsed"></td>`);
              }
              else{
                document.write(`<td  ></td>`);
              }
            }
            
          </script>
        </tr>
        <script>
          function hide17thColumn() {
            var columnsToHide = document.querySelectorAll("th:nth-child(16), td:nth-child(16)");
        
            for (var i = 0; i < columnsToHide.length; i++) {
                columnsToHide[i].style.display = "none";
            }
        }
        </script>
    </thead>
    <tbody id="data-table-body">
        <tr>
            <th></th>
            <th></th>
            <th></th>
            <th>FYE 2022</th>
            <th class="collapsed" >September</th>
            <th class="collapsed" >October</th>
            <th class="collapsed" >November</th>
            <th class="collapsed" >December</th>
            <th class="collapsed" >January</th>
            <th class="collapsed">February</th>
            <th class="collapsed">March</th>
            <th class="collapsed">April</th>
            <th class="collapsed">May</th>
            <th class="collapsed">June</th>
            <th class="collapsed">July</th>
            <th class="collapsed">August</th>
            <th>FYTD Activity</th>
            <th>As of June</th>
        </tr>

        <script>
          function toggleRow(rowId) {
            for (var i = 0; i <=100; i++) {
              var row = document.getElementById("row" + rowId + "-" + i);
              if (row) {
                row.style.display = row.style.display === "none" ? "table-row" : "none";
              }
            }
            
            var rowElement = document.getElementById("row" + rowId);
            if (rowElement) {
              rowElement.innerHTML = rowElement.innerHTML === "-" ? "+" : "-";
            }
          }
        </script>

        <tr id="ttl-row" class="ttl-lr-row">
          <td></td>
          <td><strong>Assets</strong></td>
          <td></td>
          <script>
            for (var i = 3; i <= 17; i++) {
              if (i >= 4 && i <= 15) {
                document.write(`<td id="local-revenue-total-${i}" class="collapsed" ></td>`);
              } else {
                document.write(`<td id="local-revenue-total-${i}" ></td>`);
              }
            }
          </script>
      </tr>

        <tr >
          <td><button id="add-row-button" class="btn btn-success" type="button" onclick="addNewRowLR()" style="display:none; float: right;" >Add</button>
          </td>
          <td></td>
          <td><strong>Current Assets</td>
          <td></td>
          <td class="collapsed"></td>
          <td class="collapsed"></td>
          <td class="collapsed"></td>
          <td class="collapsed"></td>
          <td class="collapsed"></td>
          <td class="collapsed"></td>
          <td class="collapsed"></td>
          <td class="collapsed"></td>
          <td class="collapsed"></td>
          <td class="collapsed"></td>
          <td class="collapsed"> </td>
          <td class="collapsed"></td>
          <td></td>
          <td></td>
        </tr>
      
      

      {% for row in data_activitybs %}
      {% if row.Activity == 'Cash' %}

    <tr  id="row4-{{ forloop.counter }}" class="balancesheet-activity-row">
      <td>
        <a href=" {% url 'delete_bsa' row.obj row.Activity  %}" id="delete-container-{{ forloop.counter }}" style="display:none;"><i class="fas fa-times"></i></a>
      </td>
      <td>{{row.obj}}</td>
      <td>{{row.Description2}}</td>
      <td></td>
      <td class="collapsed right-align-td"><a href="#" class="viewgl_activitybs-link" data-obj="{{ row.obj }}"  data-yr="09">{{row.total_bal9}}</td>
      <td class="collapsed right-align-td"><a href="#" class="viewgl_activitybs-link" data-obj="{{ row.obj }}"  data-yr="10">{{row.total_bal10}}</td>
      <td class="collapsed right-align-td"><a href="#" class="viewgl_activitybs-link" data-obj="{{ row.obj }}"  data-yr="11">{{row.total_bal11}}</td>
      <td class="collapsed right-align-td"><a href="#" class="viewgl_activitybs-link" data-obj="{{ row.obj }}"  data-yr="12">{{row.total_bal12}}</td>
      <td class="collapsed right-align-td"><a href="#" class="viewgl_activitybs-link" data-obj="{{ row.obj }}"  data-yr="01">{{row.total_bal1}}</td>
      <td class="collapsed right-align-td"><a href="#" class="viewgl_activitybs-link" data-obj="{{ row.obj }}"  data-yr="02">{{row.total_bal2}}</td>
      <td class="collapsed right-align-td"><a href="#" class="viewgl_activitybs-link" data-obj="{{ row.obj }}"  data-yr="03">{{row.total_bal3}}</td>
      <td class="collapsed right-align-td"><a href="#" class="viewgl_activitybs-link" data-obj="{{ row.obj }}"  data-yr="04">{{row.total_bal4}}</td>
      <td class="collapsed right-align-td"><a href="#" class="viewgl_activitybs-link" data-obj="{{ row.obj }}"  data-yr="05">{{row.total_bal5}}</td>
      <td class="collapsed right-align-td"><a href="#" class="viewgl_activitybs-link" data-obj="{{ row.obj }}"  data-yr="06">{{row.total_bal6}}</td>
      <td class="collapsed right-align-td"><a href="#" class="viewgl_activitybs-link" data-obj="{{ row.obj }}"  data-yr="07">{{row.total_bal7}}</td>
      <td class="collapsed right-align-td"><a href="#" class="viewgl_activitybs-link" data-obj="{{ row.obj }}"  data-yr="08">{{row.total_bal8}}</td>
      <td class="right-align-td"></td>
      <td class="right-align-td"></td>
    </tr>
      
    {% endif %}
{% endfor %}
{% for row in data_balancesheet %}
        {% if row.Category == 'Assets' %}
        {% if row.Subcategory == 'Current Assets' %}
        {% if row.Activity == 'Cash' %}
            
            <tr id="row1-{{ forloop.counter }}" class="current-assets-row">
              <td>
                <a href=" {% url 'delete_bs' row.Description row.Subcategory  %}" id="delete-container-{{ forloop.counter }}" style="display:none;"><i class="fas fa-times"></i></a>
                <button id="row4" class="expand-button"  type="button" onclick="toggleRow(4)" style=" float: left;">+</button>
              </td>
              <td>
                <input type="hidden" class="form-control" name="updatesub[]"  value="{{row.Subcategory}}">
                <input type="hidden" class="form-control" name="updatedesc[]"  value="{{row.Description}}">
              </td>
              <td>{{row.Description}}</td>
              <td id="value-cell-{{ forloop.counter }}" contenteditable="false" class="right-align-td">
                <input type="hidden" class="form-control" id="updatefye-{{ forloop.counter }}" name="updatefye[]" placeholder="Description"  value="{{ row.FYE }}">
                {{row.FYE}}
              
              </td>
              <td class="collapsed right-align-td">{{row.difference_9}}</td>
              <td class="collapsed right-align-td">{{row.difference_10}}</td>
              <td class="collapsed right-align-td">{{row.difference_11}}</td>
              <td class="collapsed right-align-td">{{row.difference_12}}</td>
              <td class="collapsed right-align-td">{{row.difference_1}}</td>
              <td class="collapsed right-align-td">{{row.difference_2}}</td>
              <td class="collapsed right-align-td">{{row.difference_3}}</td>
              <td class="collapsed right-align-td">{{row.difference_4}}</td>
              <td class="collapsed right-align-td">{{row.difference_5}}</td>
              <td class="collapsed right-align-td">{{row.difference_6}}</td>
              <td class="collapsed right-align-td"></td>
              <td class="collapsed right-align-td"></td>
              <td class="right-align-td">{{row.fytd}}</td>
              <td class="right-align-td">{{row.difference_6}}</td>
            </tr> 
            {% endif %}    
            {% endif %}   
        {% endif %}
      {% endfor %}
      
      <tr id="new-row-template" style="display: none;">
        <td></td>
        <td ><select class="form-control" name="Activity[]">
              
          <option value=""></option>
      {% for activity in bs_activity_list %}
          <option value="{{ activity }}">{{activity }}</option>
      {% endfor %}    
        </select></td>
        <td class="width20"><input type="text" class="form-control" name="Description[]" placeholder="Description"></td>
        <td class="width20"><input type="text" class="form-control" name="fye[]" placeholder="FYE" oninput="validateBudgetInput(event)"></td>
        <td></td>
      </tr>

      <script>
        function addNewRowLR() {
          const newRowTemplate = document.getElementById('new-row-template');
          const newRow = newRowTemplate.cloneNode(true);
          newRow.removeAttribute('style');
      
          
          
      
          const currentAssetRows = document.querySelectorAll('.current-assets-row');
          const lastCurrentAssetRow = currentAssetRows[currentAssetRows.length - 1];
          lastCurrentAssetRow.insertAdjacentElement('afterend', newRow);
        }

      </script>



<!-- END FOR CURRENT ASSETS CASH-->


{% for row in data_activitybs %}
{% if row.Activity == 'Restr' %}

<tr id="row5-{{ forloop.counter }}" class="balancesheet-activity-row">
<td>
<a href=" {% url 'delete_bsa' row.obj row.Activity  %}" id="delete-container-{{ forloop.counter }}" style="display:none;"><i class="fas fa-times"></i></a>

</td>
<td>{{row.obj}}</td>
<td>{{row.Description2}}</td>
<td></td>
<td class="collapsed right-align-td"><a href="#" class="viewgl_activitybs-link" data-obj="{{ row.obj }}"  data-yr="09">{{row.total_bal9}}</td>
<td class="collapsed right-align-td"><a href="#" class="viewgl_activitybs-link" data-obj="{{ row.obj }}"  data-yr="10">{{row.total_bal10}}</td>
<td class="collapsed right-align-td"><a href="#" class="viewgl_activitybs-link" data-obj="{{ row.obj }}"  data-yr="11">{{row.total_bal11}}</td>
<td class="collapsed right-align-td"><a href="#" class="viewgl_activitybs-link" data-obj="{{ row.obj }}"  data-yr="12">{{row.total_bal12}}</td>
<td class="collapsed right-align-td"><a href="#" class="viewgl_activitybs-link" data-obj="{{ row.obj }}"  data-yr="01">{{row.total_bal1}}</td>
<td class="collapsed right-align-td"><a href="#" class="viewgl_activitybs-link" data-obj="{{ row.obj }}"  data-yr="02">{{row.total_bal2}}</td>
<td class="collapsed right-align-td"><a href="#" class="viewgl_activitybs-link" data-obj="{{ row.obj }}"  data-yr="03">{{row.total_bal3}}</td>
<td class="collapsed right-align-td"><a href="#" class="viewgl_activitybs-link" data-obj="{{ row.obj }}"  data-yr="04">{{row.total_bal4}}</td>
<td class="collapsed right-align-td"><a href="#" class="viewgl_activitybs-link" data-obj="{{ row.obj }}"  data-yr="05">{{row.total_bal5}}</td>
<td class="collapsed right-align-td"><a href="#" class="viewgl_activitybs-link" data-obj="{{ row.obj }}"  data-yr="06">{{row.total_bal6}}</td>
<td class="collapsed right-align-td"><a href="#" class="viewgl_activitybs-link" data-obj="{{ row.obj }}"  data-yr="07">{{row.total_bal7}}</td>
<td class="collapsed right-align-td"><a href="#" class="viewgl_activitybs-link" data-obj="{{ row.obj }}"  data-yr="08">{{row.total_bal8}}</td>
<td class="right-align-td"></td>
<td class="right-align-td"></td>
</tr>

{% endif %}
{% endfor %}


{% for row in data_balancesheet %}
{% if row.Category == 'Assets' %}
{% if row.Subcategory == 'Current Assets' %}
{% if row.Activity == 'Restr' %}
    
    <tr id="row1-{{ forloop.counter }}" class="current-assets-row">
      <td>
        <a href=" {% url 'delete_bs' row.Description row.Subcategory  %}" id="delete-container-{{ forloop.counter }}" style="display:none;"><i class="fas fa-times"></i></a>
        <button id="row5" class="expand-button"  type="button" onclick="toggleRow(5)" style=" float: left;">+</button>
      </td>
      <td>
        <input type="hidden" class="form-control" name="updatesub[]"  value="{{row.Subcategory}}">
        <input type="hidden" class="form-control" name="updatedesc[]"  value="{{row.Description}}">
      </td>
      <td>{{row.Description}} </td>
      <td id="value-cell-{{ forloop.counter }}" contenteditable="false" class="right-align-td">
        <input type="hidden" class="form-control" id="updatefye-{{ forloop.counter }}" name="updatefye[]" placeholder="Description"  value="{{ row.FYE }}">
        {{row.FYE}}
      
      </td>
      <td class="collapsed right-align-td">{{row.difference_9}}</td>
      <td class="collapsed right-align-td">{{row.difference_10}}</td>
      <td class="collapsed right-align-td">{{row.difference_11}}</td>
      <td class="collapsed right-align-td">{{row.difference_12}}</td>
      <td class="collapsed right-align-td">{{row.difference_1}}</td>
      <td class="collapsed right-align-td">{{row.difference_2}}</td>
      <td class="collapsed right-align-td">{{row.difference_3}}</td>
      <td class="collapsed right-align-td">{{row.difference_4}}</td>
      <td class="collapsed right-align-td">{{row.difference_5}}</td>
      <td class="collapsed right-align-td">{{row.difference_6}}</td>
      <td class="collapsed right-align-td"></td>
      <td class="collapsed right-align-td"></td>
      <td class="right-align-td">{{row.fytd}}</td>
      <td class="right-align-td">{{row.difference_6}}</td>
    </tr> 
    {% endif %}    
    {% endif %}   
{% endif %}
{% endfor %}
<!-- END OF RESTR-->



{% for row in data_activitybs %}
{% if row.Activity == 'DFS+F' %}

<tr id="row6-{{ forloop.counter }}" class="balancesheet-activity-row">
<td>
<a href=" {% url 'delete_bsa' row.obj row.Activity  %}" id="delete-container-{{ forloop.counter }}" style="display:none;"><i class="fas fa-times"></i></a>
</td>
<td>{{row.obj}}</td>
<td>{{row.Description2}}</td>
<td></td>
<td class="collapsed right-align-td"><a href="#" class="viewgl_activitybs-link" data-obj="{{ row.obj }}"  data-yr="09">{{row.total_bal9}}</td>
<td class="collapsed right-align-td"><a href="#" class="viewgl_activitybs-link" data-obj="{{ row.obj }}"  data-yr="10">{{row.total_bal10}}</td>
<td class="collapsed right-align-td"><a href="#" class="viewgl_activitybs-link" data-obj="{{ row.obj }}"  data-yr="11">{{row.total_bal11}}</td>
<td class="collapsed right-align-td"><a href="#" class="viewgl_activitybs-link" data-obj="{{ row.obj }}"  data-yr="12">{{row.total_bal12}}</td>
<td class="collapsed right-align-td"><a href="#" class="viewgl_activitybs-link" data-obj="{{ row.obj }}"  data-yr="01">{{row.total_bal1}}</td>
<td class="collapsed right-align-td"><a href="#" class="viewgl_activitybs-link" data-obj="{{ row.obj }}"  data-yr="02">{{row.total_bal2}}</td>
<td class="collapsed right-align-td"><a href="#" class="viewgl_activitybs-link" data-obj="{{ row.obj }}"  data-yr="03">{{row.total_bal3}}</td>
<td class="collapsed right-align-td"><a href="#" class="viewgl_activitybs-link" data-obj="{{ row.obj }}"  data-yr="04">{{row.total_bal4}}</td>
<td class="collapsed right-align-td"><a href="#" class="viewgl_activitybs-link" data-obj="{{ row.obj }}"  data-yr="05">{{row.total_bal5}}</td>
<td class="collapsed right-align-td"><a href="#" class="viewgl_activitybs-link" data-obj="{{ row.obj }}"  data-yr="06">{{row.total_bal6}}</td>
<td class="collapsed right-align-td"><a href="#" class="viewgl_activitybs-link" data-obj="{{ row.obj }}"  data-yr="07">{{row.total_bal7}}</td>
<td class="collapsed right-align-td"><a href="#" class="viewgl_activitybs-link" data-obj="{{ row.obj }}"  data-yr="08">{{row.total_bal8}}</td>
<td class="right-align-td"></td>
<td class="right-align-td"></td>
</tr>

{% endif %}
{% endfor %}

{% for row in data_balancesheet %}
{% if row.Category == 'Assets' %}
{% if row.Subcategory == 'Current Assets' %}
{% if row.Activity == 'DFS+F' %}
    
    <tr id="row1-{{ forloop.counter }}" class="current-assets-row">
      <td>
        <a href=" {% url 'delete_bs' row.Description row.Subcategory  %}" id="delete-container-{{ forloop.counter }}" style="display:none;"><i class="fas fa-times"></i></a>
        <button id="row6" class="expand-button"  type="button" onclick="toggleRow(6)" style=" float: left;">+</button>
      </td>
      <td>
        <input type="hidden" class="form-control" name="updatesub[]"  value="{{row.Subcategory}}">
        <input type="hidden" class="form-control" name="updatedesc[]"  value="{{row.Description}}">
      </td>
      <td>{{row.Description}} </td>
      <td id="value-cell-{{ forloop.counter }}" contenteditable="false" class="right-align-td">
        <input type="hidden" class="form-control" id="updatefye-{{ forloop.counter }}" name="updatefye[]" placeholder="Description"  value="{{ row.FYE }}">
        {{row.FYE}}
      
      </td>
      <td class="collapsed right-align-td">{{row.difference_9}}</td>
      <td class="collapsed right-align-td">{{row.difference_10}}</td>
      <td class="collapsed right-align-td">{{row.difference_11}}</td>
      <td class="collapsed right-align-td">{{row.difference_12}}</td>
      <td class="collapsed right-align-td">{{row.difference_1}}</td>
      <td class="collapsed right-align-td">{{row.difference_2}}</td>
      <td class="collapsed right-align-td">{{row.difference_3}}</td>
      <td class="collapsed right-align-td">{{row.difference_4}}</td>
      <td class="collapsed right-align-td">{{row.difference_5}}</td>
      <td class="collapsed right-align-td">{{row.difference_6}}</td>
      <td class="collapsed right-align-td"></td>
      <td class="collapsed right-align-td"></td>
      <td class="right-align-td">{{row.fytd}}</td>
      <td class="right-align-td">{{row.difference_6}}</td>
    </tr> 
    {% endif %}    
    {% endif %}   
{% endif %}
{% endfor %}

<!-- END OF DFS+F-->


{% for row in data_activitybs %}
{% if row.Activity == 'OTHR' %}

<tr id="row7-{{ forloop.counter }}" class="balancesheet-activity-row">
<td>
<a href=" {% url 'delete_bsa' row.obj row.Activity  %}" id="delete-container-{{ forloop.counter }}" style="display:none;"><i class="fas fa-times"></i></a>
</td>
<td>{{row.obj}}</td>
<td>{{row.Description2}}</td>
<td></td>
<td class="collapsed right-align-td"><a href="#" class="viewgl_activitybs-link" data-obj="{{ row.obj }}"  data-yr="09">{{row.total_bal9}}</td>
<td class="collapsed right-align-td"><a href="#" class="viewgl_activitybs-link" data-obj="{{ row.obj }}"  data-yr="10">{{row.total_bal10}}</td>
<td class="collapsed right-align-td"><a href="#" class="viewgl_activitybs-link" data-obj="{{ row.obj }}"  data-yr="11">{{row.total_bal11}}</td>
<td class="collapsed right-align-td"><a href="#" class="viewgl_activitybs-link" data-obj="{{ row.obj }}"  data-yr="12">{{row.total_bal12}}</td>
<td class="collapsed right-align-td"><a href="#" class="viewgl_activitybs-link" data-obj="{{ row.obj }}"  data-yr="01">{{row.total_bal1}}</td>
<td class="collapsed right-align-td"><a href="#" class="viewgl_activitybs-link" data-obj="{{ row.obj }}"  data-yr="02">{{row.total_bal2}}</td>
<td class="collapsed right-align-td"><a href="#" class="viewgl_activitybs-link" data-obj="{{ row.obj }}"  data-yr="03">{{row.total_bal3}}</td>
<td class="collapsed right-align-td"><a href="#" class="viewgl_activitybs-link" data-obj="{{ row.obj }}"  data-yr="04">{{row.total_bal4}}</td>
<td class="collapsed right-align-td"><a href="#" class="viewgl_activitybs-link" data-obj="{{ row.obj }}"  data-yr="05">{{row.total_bal5}}</td>
<td class="collapsed right-align-td"><a href="#" class="viewgl_activitybs-link" data-obj="{{ row.obj }}"  data-yr="06">{{row.total_bal6}}</td>
<td class="collapsed right-align-td"><a href="#" class="viewgl_activitybs-link" data-obj="{{ row.obj }}"  data-yr="07">{{row.total_bal7}}</td>
<td class="collapsed right-align-td"><a href="#" class="viewgl_activitybs-link" data-obj="{{ row.obj }}"  data-yr="08">{{row.total_bal8}}</td>
<td class="right-align-td"></td>
<td class="right-align-td"></td>
</tr>

{% endif %}
{% endfor %}

{% for row in data_balancesheet %}
{% if row.Category == 'Assets' %}
{% if row.Subcategory == 'Current Assets' %}
{% if row.Activity == 'OTHR' %}
    
    <tr id="row1-{{ forloop.counter }}" class="current-assets-row">
      <td>
        <a href=" {% url 'delete_bs' row.Description row.Subcategory  %}" id="delete-container-{{ forloop.counter }}" style="display:none;"><i class="fas fa-times"></i></a>
        <button id="row7" class="expand-button"  type="button" onclick="toggleRow(7)" style=" float: left;">+</button>
      </td>
      <td>
        <input type="hidden" class="form-control" name="updatesub[]"  value="{{row.Subcategory}}">
        <input type="hidden" class="form-control" name="updatedesc[]"  value="{{row.Description}}">
      </td>
      <td>{{row.Description}} </td>
      <td id="value-cell-{{ forloop.counter }}" contenteditable="false" class="right-align-td">
        <input type="hidden" class="form-control" id="updatefye-{{ forloop.counter }}" name="updatefye[]" placeholder="Description"  value="{{ row.FYE }}">
        {{row.FYE}}
      
      </td>
      <td class="collapsed right-align-td">{{row.difference_9}}</td>
      <td class="collapsed right-align-td">{{row.difference_10}}</td>
      <td class="collapsed right-align-td">{{row.difference_11}}</td>
      <td class="collapsed right-align-td">{{row.difference_12}}</td>
      <td class="collapsed right-align-td">{{row.difference_1}}</td>
      <td class="collapsed right-align-td">{{row.difference_2}}</td>
      <td class="collapsed right-align-td">{{row.difference_3}}</td>
      <td class="collapsed right-align-td">{{row.difference_4}}</td>
      <td class="collapsed right-align-td">{{row.difference_5}}</td>
      <td class="collapsed right-align-td">{{row.difference_6}}</td>
      <td class="collapsed right-align-td"></td>
      <td class="collapsed right-align-td"></td>
      <td class="right-align-td">{{row.fytd}}</td>
      <td class="right-align-td">{{row.difference_6}}</td>
    </tr> 
    {% endif %}    
    {% endif %}   
{% endif %}
{% endfor %}
<!-- ENDO F OTHR-->




{% for row in data_activitybs %}
{% if row.Activity == 'Inventory' %}

<tr id="row8-{{ forloop.counter }}" class="balancesheet-activity-row">
<td>
<a href=" {% url 'delete_bsa' row.obj row.Activity  %}" id="delete-container-{{ forloop.counter }}" style="display:none;"><i class="fas fa-times"></i></a>
</td>
<td>{{row.obj}}</td>
<td>{{row.Description2}}</td>
<td></td>
<td class="collapsed right-align-td"><a href="#" class="viewgl_activitybs-link" data-obj="{{ row.obj }}"  data-yr="09">{{row.total_bal9}}</td>
<td class="collapsed right-align-td"><a href="#" class="viewgl_activitybs-link" data-obj="{{ row.obj }}"  data-yr="10">{{row.total_bal10}}</td>
<td class="collapsed right-align-td"><a href="#" class="viewgl_activitybs-link" data-obj="{{ row.obj }}"  data-yr="11">{{row.total_bal11}}</td>
<td class="collapsed right-align-td"><a href="#" class="viewgl_activitybs-link" data-obj="{{ row.obj }}"  data-yr="12">{{row.total_bal12}}</td>
<td class="collapsed right-align-td"><a href="#" class="viewgl_activitybs-link" data-obj="{{ row.obj }}"  data-yr="01">{{row.total_bal1}}</td>
<td class="collapsed right-align-td"><a href="#" class="viewgl_activitybs-link" data-obj="{{ row.obj }}"  data-yr="02">{{row.total_bal2}}</td>
<td class="collapsed right-align-td"><a href="#" class="viewgl_activitybs-link" data-obj="{{ row.obj }}"  data-yr="03">{{row.total_bal3}}</td>
<td class="collapsed right-align-td"><a href="#" class="viewgl_activitybs-link" data-obj="{{ row.obj }}"  data-yr="04">{{row.total_bal4}}</td>
<td class="collapsed right-align-td"><a href="#" class="viewgl_activitybs-link" data-obj="{{ row.obj }}"  data-yr="05">{{row.total_bal5}}</td>
<td class="collapsed right-align-td"><a href="#" class="viewgl_activitybs-link" data-obj="{{ row.obj }}"  data-yr="06">{{row.total_bal6}}</td>
<td class="collapsed right-align-td"><a href="#" class="viewgl_activitybs-link" data-obj="{{ row.obj }}"  data-yr="07">{{row.total_bal7}}</td>
<td class="collapsed right-align-td"><a href="#" class="viewgl_activitybs-link" data-obj="{{ row.obj }}"  data-yr="08">{{row.total_bal8}}</td>
<td class="right-align-td"></td>
<td class="right-align-td"></td>
</tr>

{% endif %}
{% endfor %}

{% for row in data_balancesheet %}
{% if row.Category == 'Assets' %}
{% if row.Subcategory == 'Current Assets' %}
{% if row.Activity == 'Inventory' %}
    
    <tr id="row1-{{ forloop.counter }}" class="current-assets-row">
      <td>
        <a href=" {% url 'delete_bs' row.Description row.Subcategory  %}" id="delete-container-{{ forloop.counter }}" style="display:none;"><i class="fas fa-times"></i></a>
        <button id="row8" class="expand-button"  type="button" onclick="toggleRow(8)" style=" float: left;">+</button>
      </td>
      <td>
        <input type="hidden" class="form-control" name="updatesub[]"  value="{{row.Subcategory}}">
        <input type="hidden" class="form-control" name="updatedesc[]"  value="{{row.Description}}">
      </td>
      <td>{{row.Description}} </td>
      <td id="value-cell-{{ forloop.counter }}" contenteditable="false" class="right-align-td">
        <input type="hidden" class="form-control" id="updatefye-{{ forloop.counter }}" name="updatefye[]" placeholder="Description"  value="{{ row.FYE }}">
        {{row.FYE}}
      
      </td>
      <td class="collapsed right-align-td">{{row.difference_9}}</td>
      <td class="collapsed right-align-td">{{row.difference_10}}</td>
      <td class="collapsed right-align-td">{{row.difference_11}}</td>
      <td class="collapsed right-align-td">{{row.difference_12}}</td>
      <td class="collapsed right-align-td">{{row.difference_1}}</td>
      <td class="collapsed right-align-td">{{row.difference_2}}</td>
      <td class="collapsed right-align-td">{{row.difference_3}}</td>
      <td class="collapsed right-align-td">{{row.difference_4}}</td>
      <td class="collapsed right-align-td">{{row.difference_5}}</td>
      <td class="collapsed right-align-td">{{row.difference_6}}</td>
      <td class="collapsed right-align-td"></td>
      <td class="collapsed right-align-td"></td>
      <td class="right-align-td">{{row.fytd}}</td>
      <td class="right-align-td">{{row.difference_6}}</td>
    </tr> 
    {% endif %}    
    {% endif %}   
{% endif %}
{% endfor %}
<!-- END OF INVENTORY-->



{% for row in data_activitybs %}
{% if row.Activity == 'PPD' %}

<tr  id="row9-{{ forloop.counter }}" class="balancesheet-activity-row">
<td>
<a href=" {% url 'delete_bsa' row.obj row.Activity  %}" id="delete-container-{{ forloop.counter }}" style="display:none;"><i class="fas fa-times"></i></a>
</td>
<td>{{row.obj}}</td>
<td>{{row.Description2}}</td>
<td></td>
<td class="collapsed right-align-td"><a href="#" class="viewgl_activitybs-link" data-obj="{{ row.obj }}"  data-yr="09">{{row.total_bal9}}</td>
<td class="collapsed right-align-td"><a href="#" class="viewgl_activitybs-link" data-obj="{{ row.obj }}"  data-yr="10">{{row.total_bal10}}</td>
<td class="collapsed right-align-td"><a href="#" class="viewgl_activitybs-link" data-obj="{{ row.obj }}"  data-yr="11">{{row.total_bal11}}</td>
<td class="collapsed right-align-td"><a href="#" class="viewgl_activitybs-link" data-obj="{{ row.obj }}"  data-yr="12">{{row.total_bal12}}</td>
<td class="collapsed right-align-td"><a href="#" class="viewgl_activitybs-link" data-obj="{{ row.obj }}"  data-yr="01">{{row.total_bal1}}</td>
<td class="collapsed right-align-td"><a href="#" class="viewgl_activitybs-link" data-obj="{{ row.obj }}"  data-yr="02">{{row.total_bal2}}</td>
<td class="collapsed right-align-td"><a href="#" class="viewgl_activitybs-link" data-obj="{{ row.obj }}"  data-yr="03">{{row.total_bal3}}</td>
<td class="collapsed right-align-td"><a href="#" class="viewgl_activitybs-link" data-obj="{{ row.obj }}"  data-yr="04">{{row.total_bal4}}</td>
<td class="collapsed right-align-td"><a href="#" class="viewgl_activitybs-link" data-obj="{{ row.obj }}"  data-yr="05">{{row.total_bal5}}</td>
<td class="collapsed right-align-td"><a href="#" class="viewgl_activitybs-link" data-obj="{{ row.obj }}"  data-yr="06">{{row.total_bal6}}</td>
<td class="collapsed right-align-td"><a href="#" class="viewgl_activitybs-link" data-obj="{{ row.obj }}"  data-yr="07">{{row.total_bal7}}</td>
<td class="collapsed right-align-td"><a href="#" class="viewgl_activitybs-link" data-obj="{{ row.obj }}"  data-yr="08">{{row.total_bal8}}</td>
<td class="right-align-td"></td>
<td class="right-align-td"></td>
</tr>

{% endif %}
{% endfor %}

{% for row in data_balancesheet %}
{% if row.Category == 'Assets' %}
{% if row.Subcategory == 'Current Assets' %}
{% if row.Activity == 'PPD' %}
    
    <tr id="row1-{{ forloop.counter }}" class="current-assets-row">
      <td>
        <a href=" {% url 'delete_bs' row.Description row.Subcategory  %}" id="delete-container-{{ forloop.counter }}" style="display:none;"><i class="fas fa-times"></i></a>
        <button id="row9" class="expand-button"  type="button" onclick="toggleRow(9)" style=" float: left;">+</button>
      </td>
      <td>
        <input type="hidden" class="form-control" name="updatesub[]"  value="{{row.Subcategory}}">
        <input type="hidden" class="form-control" name="updatedesc[]"  value="{{row.Description}}">
      </td>
      <td>{{row.Description}} </td>
      <td id="value-cell-{{ forloop.counter }}" contenteditable="false" class="right-align-td">
        <input type="hidden" class="form-control" id="updatefye-{{ forloop.counter }}" name="updatefye[]" placeholder="Description"  value="{{ row.FYE }}">
        {{row.FYE}}
      
      </td>
      <td class="collapsed right-align-td">{{row.difference_9}}</td>
      <td class="collapsed right-align-td">{{row.difference_10}}</td>
      <td class="collapsed right-align-td">{{row.difference_11}}</td>
      <td class="collapsed right-align-td">{{row.difference_12}}</td>
      <td class="collapsed right-align-td">{{row.difference_1}}</td>
      <td class="collapsed right-align-td">{{row.difference_2}}</td>
      <td class="collapsed right-align-td">{{row.difference_3}}</td>
      <td class="collapsed right-align-td">{{row.difference_4}}</td>
      <td class="collapsed right-align-td">{{row.difference_5}}</td>
      <td class="collapsed right-align-td">{{row.difference_6}}</td>
      <td class="collapsed right-align-td"></td>
      <td class="collapsed right-align-td"></td>
      <td class="right-align-td">{{row.fytd}}</td>
      <td class="right-align-td">{{row.difference_6}}</td>
    </tr> 
    {% endif %}    
    {% endif %}   
{% endif %}
{% endfor %}

      <tr id="ttl-row"  class="total-assets-row">
        <td></td>
        <td></td>
        <td><strong>Total Current Assets</strong></td>
        <script>
          for (var i = 3; i <= 17; i++) {
            if (i >= 4 && i <= 15) {
              document.write(`<td id="current-assets-total-${i}" class="collapsed right-align-td" ></td>`);
            } else {
              document.write(`<td id="current-assets-total-${i}" class="right-align-td"></td>`);
            }
          }
        </script>
    </tr>

    
    <tr id="new-row-template-Capital-assets" style="display: none;">
      <td></td>
      <td ><select class="form-control" name="Activity_Capital_Assets[]">
            
        <option value=""></option>
    {% for activity in bs_activity_list %}
        <option value="{{ activity }}">{{activity }}</option>
    {% endfor %}    
      </select></td>
      <td class="width20"><input type="text" class="form-control" name="Description_Capital_Assets[]" placeholder="Description"></td>
      <td class="width20"><input type="text" class="form-control" name="fye_Capital_Assets[]" placeholder="FYE" oninput="validateBudgetInput(event)"></td>
      <td></td>
    </tr>

<script>
      function addNewCapitalAssets() {
        const newRowTemplate = document.getElementById('new-row-template-Capital-assets');
        const newRow = newRowTemplate.cloneNode(true);
        newRow.removeAttribute('style');
    
        
        
    
        const capitalAssetRows = document.querySelectorAll('.capital-assets-row');
        const lastCapitalAssetRow = capitalAssetRows[capitalAssetRows.length - 1];
        lastCapitalAssetRow.insertAdjacentElement('afterend', newRow);
      }
</script>
      

      <tr >
        <td>
         
          <button id="add-row-button-capital-assets" class="btn btn-success" type="button" onclick="addNewCapitalAssets()" style="display:none; float: right;" >Add</button>
        </td>
        <td></td>
        <td><strong>Capital Assets , Net</strong></td>
        <td></td>
        <td class="collapsed"></td>
        <td class="collapsed"></td>
        <td class="collapsed"></td>
        <td class="collapsed"></td>
        <td class="collapsed"></td>
        <td class="collapsed"></td>
        <td class="collapsed"></td>
        <td class="collapsed"></td>
        <td class="collapsed"></td>
        <td class="collapsed"></td>
        <td class="collapsed"> </td>
        <td class="collapsed"></td>
        <td></td>
        <td></td>
      </tr>
             

      

      
      {% for row in data_activitybs %}
      {% if row.Activity == 'FA-L' %}

    <tr id="row10-{{ forloop.counter }}" class="balancesheet-activity-row">
      <td>
        <a href=" {% url 'delete_bsa' row.obj row.Activity  %}" id="delete-container-{{ forloop.counter }}" style="display:none;"><i class="fas fa-times"></i></a>
      </td>
      <td>{{row.obj}}</td>
      <td>{{row.Description2}}</td>
      <td></td>
      <td class="collapsed right-align-td"><a href="#" class="viewgl_activitybs-link" data-obj="{{ row.obj }}"  data-yr="09">{{row.total_bal9}}</td>
      <td class="collapsed right-align-td"><a href="#" class="viewgl_activitybs-link" data-obj="{{ row.obj }}"  data-yr="10">{{row.total_bal10}}</td>
      <td class="collapsed right-align-td"><a href="#" class="viewgl_activitybs-link" data-obj="{{ row.obj }}"  data-yr="11">{{row.total_bal11}}</td>
      <td class="collapsed right-align-td"><a href="#" class="viewgl_activitybs-link" data-obj="{{ row.obj }}"  data-yr="12">{{row.total_bal12}}</td>
      <td class="collapsed right-align-td"><a href="#" class="viewgl_activitybs-link" data-obj="{{ row.obj }}"  data-yr="01">{{row.total_bal1}}</td>
      <td class="collapsed right-align-td"><a href="#" class="viewgl_activitybs-link" data-obj="{{ row.obj }}"  data-yr="02">{{row.total_bal2}}</td>
      <td class="collapsed right-align-td"><a href="#" class="viewgl_activitybs-link" data-obj="{{ row.obj }}"  data-yr="03">{{row.total_bal3}}</td>
      <td class="collapsed right-align-td"><a href="#" class="viewgl_activitybs-link" data-obj="{{ row.obj }}"  data-yr="04">{{row.total_bal4}}</td>
      <td class="collapsed right-align-td"><a href="#" class="viewgl_activitybs-link" data-obj="{{ row.obj }}"  data-yr="05">{{row.total_bal5}}</td>
      <td class="collapsed right-align-td"><a href="#" class="viewgl_activitybs-link" data-obj="{{ row.obj }}"  data-yr="06">{{row.total_bal6}}</td>
      <td class="collapsed right-align-td"><a href="#" class="viewgl_activitybs-link" data-obj="{{ row.obj }}"  data-yr="07">{{row.total_bal7}}</td>
      <td class="collapsed right-align-td"><a href="#" class="viewgl_activitybs-link" data-obj="{{ row.obj }}"  data-yr="08">{{row.total_bal8}}</td>
      <td class="right-align-td"></td>
      <td class="right-align-td"></td>
    </tr>
      
    {% endif %}
{% endfor %}

{% for row in data_balancesheet %}
        {% if row.Category == 'Assets' %}
        {% if row.Subcategory == 'Capital Assets, Net' %}
        {% if row.Activity == 'FA-L' %}
           
            <tr id="row2-{{ forloop.counter }}" class="capital-assets-row">
              <td>
                <a href=" {% url 'delete_bs' row.Description row.Subcategory  %}" id="delete-container-{{ forloop.counter }}" style="display:none;"><i class="fas fa-times"></i></a>
                <button id="row10" class="expand-button"  type="button" onclick="toggleRow(10)" style=" float: left;">+</button>
              </td>
              <td>
                <input type="hidden" class="form-control" name="updatesub[]"  value="{{row.Subcategory}}">
                <input type="hidden" class="form-control" name="updatedesc[]"  value="{{row.Description}}">
              </td>
              <td>{{row.Description}}</td>
              <td id="value-cell-{{ forloop.counter }}" contenteditable="false" class="right-align-td">
                <input type="hidden" class="form-control" id="updatefye-{{ forloop.counter }}" name="updatefye[]" placeholder="Description"  value="{{ row.FYE }}">
                {{row.FYE}}
              
              </td>
              <td class="collapsed right-align-td">{{row.difference_9}}</td>
              <td class="collapsed right-align-td">{{row.difference_10}}</td>
              <td class="collapsed right-align-td">{{row.difference_11}}</td>
              <td class="collapsed right-align-td">{{row.difference_12}}</td>
              <td class="collapsed right-align-td">{{row.difference_1}}</td>
              <td class="collapsed right-align-td">{{row.difference_2}}</td>
              <td class="collapsed right-align-td">{{row.difference_3}}</td>
              <td class="collapsed right-align-td">{{row.difference_4}}</td>
              <td class="collapsed right-align-td">{{row.difference_5}}</td>
              <td class="collapsed right-align-td">{{row.difference_6}}</td>
              <td class="collapsed right-align-td"></td>
              <td class="collapsed right-align-td"></td>
              <td class="right-align-td">{{row.fytd}}</td>
              <td class="right-align-td">{{row.difference_6}}</td>
            </tr>
            {% endif %} 
            {% endif %}   
        {% endif %}
      {% endfor %}

<!-- END OF FA-L -->




{% for row in data_activitybs %}
{% if row.Activity == 'FA-BFE' %}

<tr id="row11-{{ forloop.counter }}" class="balancesheet-activity-row">
<td>
<a href=" {% url 'delete_bsa' row.obj row.Activity  %}" id="delete-container-{{ forloop.counter }}" style="display:none;"><i class="fas fa-times"></i></a>
</td>
<td>{{row.obj}}</td>
<td>{{row.Description2}}</td>
<td></td>
<td class="collapsed right-align-td"><a href="#" class="viewgl_activitybs-link" data-obj="{{ row.obj }}"  data-yr="09">{{row.total_bal9}}</td>
<td class="collapsed right-align-td"><a href="#" class="viewgl_activitybs-link" data-obj="{{ row.obj }}"  data-yr="10">{{row.total_bal10}}</td>
<td class="collapsed right-align-td"><a href="#" class="viewgl_activitybs-link" data-obj="{{ row.obj }}"  data-yr="11">{{row.total_bal11}}</td>
<td class="collapsed right-align-td"><a href="#" class="viewgl_activitybs-link" data-obj="{{ row.obj }}"  data-yr="12">{{row.total_bal12}}</td>
<td class="collapsed right-align-td"><a href="#" class="viewgl_activitybs-link" data-obj="{{ row.obj }}"  data-yr="01">{{row.total_bal1}}</td>
<td class="collapsed right-align-td"><a href="#" class="viewgl_activitybs-link" data-obj="{{ row.obj }}"  data-yr="02">{{row.total_bal2}}</td>
<td class="collapsed right-align-td"><a href="#" class="viewgl_activitybs-link" data-obj="{{ row.obj }}"  data-yr="03">{{row.total_bal3}}</td>
<td class="collapsed right-align-td"><a href="#" class="viewgl_activitybs-link" data-obj="{{ row.obj }}"  data-yr="04">{{row.total_bal4}}</td>
<td class="collapsed right-align-td"><a href="#" class="viewgl_activitybs-link" data-obj="{{ row.obj }}"  data-yr="05">{{row.total_bal5}}</td>
<td class="collapsed right-align-td"><a href="#" class="viewgl_activitybs-link" data-obj="{{ row.obj }}"  data-yr="06">{{row.total_bal6}}</td>
<td class="collapsed right-align-td"><a href="#" class="viewgl_activitybs-link" data-obj="{{ row.obj }}"  data-yr="07">{{row.total_bal7}}</td>
<td class="collapsed right-align-td"><a href="#" class="viewgl_activitybs-link" data-obj="{{ row.obj }}"  data-yr="08">{{row.total_bal8}}</td>
<td class="right-align-td"></td>
<td class="right-align-td"></td>
</tr>

{% endif %}
{% endfor %}

{% for row in data_balancesheet %}
{% if row.Category == 'Assets' %}
{% if row.Subcategory == 'Capital Assets, Net' %}
{% if row.Activity == 'FA-BFE' %}
   
    <tr id="row2-{{ forloop.counter }}" class="capital-assets-row">
      <td>
        <a href=" {% url 'delete_bs' row.Description row.Subcategory  %}" id="delete-container-{{ forloop.counter }}" style="display:none;"><i class="fas fa-times"></i></a>
        <button id="row11" class="expand-button"  type="button" onclick="toggleRow(11)" style=" float: left;">+</button>
      </td>
      <td>
        <input type="hidden" class="form-control" name="updatesub[]"  value="{{row.Subcategory}}">
        <input type="hidden" class="form-control" name="updatedesc[]"  value="{{row.Description}}">
      </td>
      <td>{{row.Description}} </td>
      <td id="value-cell-{{ forloop.counter }}" contenteditable="false" class="right-align-td">
        <input type="hidden" class="form-control" id="updatefye-{{ forloop.counter }}" name="updatefye[]" placeholder="Description"  value="{{ row.FYE }}">
        {{row.FYE}}
      
      </td>
      <td class="collapsed right-align-td">{{row.difference_9}}</td>
      <td class="collapsed right-align-td">{{row.difference_10}}</td>
      <td class="collapsed right-align-td">{{row.difference_11}}</td>
      <td class="collapsed right-align-td">{{row.difference_12}}</td>
      <td class="collapsed right-align-td">{{row.difference_1}}</td>
      <td class="collapsed right-align-td">{{row.difference_2}}</td>
      <td class="collapsed right-align-td">{{row.difference_3}}</td>
      <td class="collapsed right-align-td">{{row.difference_4}}</td>
      <td class="collapsed right-align-td">{{row.difference_5}}</td>
      <td class="collapsed right-align-td">{{row.difference_6}}</td>
      <td class="collapsed right-align-td"></td>
      <td class="collapsed right-align-td"></td>
      <td class="right-align-td">{{row.fytd}}</td>
      <td class="right-align-td">{{row.difference_6}}</td>
    </tr>
    {% endif %} 
    {% endif %}   
{% endif %}
{% endfor %}
<!-- END OF FA-BFE -->




{% for row in data_activitybs %}
{% if row.Activity == 'FA-AD' %}

<tr id="row12-{{ forloop.counter }}" class="balancesheet-activity-row">
<td>
<a href=" {% url 'delete_bsa' row.obj row.Activity  %}" id="delete-container-{{ forloop.counter }}" style="display:none;"><i class="fas fa-times"></i></a>
</td>
<td>{{row.obj}}</td>
<td>{{row.Description2}}</td>
<td></td>
<td class="collapsed right-align-td"><a href="#" class="viewgl_activitybs-link" data-obj="{{ row.obj }}"  data-yr="09">{{row.total_bal9}}</td>
<td class="collapsed right-align-td"><a href="#" class="viewgl_activitybs-link" data-obj="{{ row.obj }}"  data-yr="10">{{row.total_bal10}}</td>
<td class="collapsed right-align-td"><a href="#" class="viewgl_activitybs-link" data-obj="{{ row.obj }}"  data-yr="11">{{row.total_bal11}}</td>
<td class="collapsed right-align-td"><a href="#" class="viewgl_activitybs-link" data-obj="{{ row.obj }}"  data-yr="12">{{row.total_bal12}}</td>
<td class="collapsed right-align-td"><a href="#" class="viewgl_activitybs-link" data-obj="{{ row.obj }}"  data-yr="01">{{row.total_bal1}}</td>
<td class="collapsed right-align-td"><a href="#" class="viewgl_activitybs-link" data-obj="{{ row.obj }}"  data-yr="02">{{row.total_bal2}}</td>
<td class="collapsed right-align-td"><a href="#" class="viewgl_activitybs-link" data-obj="{{ row.obj }}"  data-yr="03">{{row.total_bal3}}</td>
<td class="collapsed right-align-td"><a href="#" class="viewgl_activitybs-link" data-obj="{{ row.obj }}"  data-yr="04">{{row.total_bal4}}</td>
<td class="collapsed right-align-td"><a href="#" class="viewgl_activitybs-link" data-obj="{{ row.obj }}"  data-yr="05">{{row.total_bal5}}</td>
<td class="collapsed right-align-td"><a href="#" class="viewgl_activitybs-link" data-obj="{{ row.obj }}"  data-yr="06">{{row.total_bal6}}</td>
<td class="collapsed right-align-td"><a href="#" class="viewgl_activitybs-link" data-obj="{{ row.obj }}"  data-yr="07">{{row.total_bal7}}</td>
<td class="collapsed right-align-td"><a href="#" class="viewgl_activitybs-link" data-obj="{{ row.obj }}"  data-yr="08">{{row.total_bal8}}</td>
<td class="right-align-td"></td>
<td class="right-align-td"></td>
</tr>

{% endif %}
{% endfor %}

{% for row in data_balancesheet %}
{% if row.Category == 'Assets' %}
{% if row.Subcategory == 'Capital Assets, Net' %}
{% if row.Activity == 'FA-AD' %}
   
    <tr id="row2-{{ forloop.counter }}" class="capital-assets-row">
      <td>
        <a href=" {% url 'delete_bs' row.Description row.Subcategory  %}" id="delete-container-{{ forloop.counter }}" style="display:none;"><i class="fas fa-times"></i></a>
        <button id="row12" class="expand-button"  type="button" onclick="toggleRow(12)" style=" float: left;">+</button>
      </td>
      <td>
        <input type="hidden" class="form-control" name="updatesub[]"  value="{{row.Subcategory}}">
        <input type="hidden" class="form-control" name="updatedesc[]"  value="{{row.Description}}">
      </td>
      <td>{{row.Description}}</td>
      <td id="value-cell-{{ forloop.counter }}" contenteditable="false" class="right-align-td">
        <input type="hidden" class="form-control" id="updatefye-{{ forloop.counter }}" name="updatefye[]" placeholder="Description"  value="{{ row.FYE }}">
        {{row.FYE}}
      
      </td>
      <td class="collapsed right-align-td">{{row.difference_9}}</td>
      <td class="collapsed right-align-td">{{row.difference_10}}</td>
      <td class="collapsed right-align-td">{{row.difference_11}}</td>
      <td class="collapsed right-align-td">{{row.difference_12}}</td>
      <td class="collapsed right-align-td">{{row.difference_1}}</td>
      <td class="collapsed right-align-td">{{row.difference_2}}</td>
      <td class="collapsed right-align-td">{{row.difference_3}}</td>
      <td class="collapsed right-align-td">{{row.difference_4}}</td>
      <td class="collapsed right-align-td">{{row.difference_5}}</td>
      <td class="collapsed right-align-td">{{row.difference_6}}</td>
      <td class="collapsed right-align-td"></td>
      <td class="collapsed right-align-td"></td>
      <td class="right-align-td">{{row.fytd}}</td>
      <td class="right-align-td">{{row.difference_6}}</td>
    </tr>
    {% endif %} 
    {% endif %}   
{% endif %}
{% endfor %}
      
      <tr id="ttl-row" class="total-assets-row">
            <td></td>
            <td></td>
            <td><strong>Total Capital Assets</strong></td>
            <script>
              for (var i = 3; i <= 17; i++) {
                if (i >= 4 && i <= 15) {
                  document.write(`<td id="capital-assets-total-${i}" class="collapsed right-align-td" ></td>`);
                } else {
                  document.write(`<td id="capital-assets-total-${i}" class="right-align-td"></td>`);
                }
              }
            </script>
        </tr>

        <tr id="ttl-row" class="ttl-lr-row">
          <td></td>
          <td></td>
          <td><strong>Total  Assets</strong></td>
          <script>
            for (var i = 3; i <= 17; i++) {
              if (i >= 4 && i <= 15) {
                document.write(`<td id="total-assets-total-${i}" class="collapsed right-align-td" ></td>`);
              } else {
                document.write(`<td id="total-assets-total-${i}" class="right-align-td"></td>`);
              }
            }
          </script>
      </tr>

      <tr id="ttl-row" class="ttl-lr-row">
        <td></td>
        <td><strong>Liabilities and Net Assets</strong></td>
        <td></td>
        <script>
          for (var i = 3; i <= 17; i++) {
            if (i >= 4 && i <= 15) {
              document.write(`<td  class="collapsed" ></td>`);
            } else {
              document.write(`<td ></td>`);
            }
          }
        </script>
    </tr>


    <tr id="new-row-template-CL" style="display: none;">
      <td></td>
      <td ><select class="form-control" name="Activity_CL[]">
            
        <option value=""></option>
    {% for activity in bs_activity_list %}
        <option value="{{ activity }}">{{activity }}</option>
    {% endfor %}    
      </select></td>
      <td class="width20"><input type="text" class="form-control" name="Description_CL[]" placeholder="Description"></td>
      <td class="width20"><input type="text" class="form-control" name="fye_CL[]" placeholder="FYE" oninput="validateBudgetInput(event)"></td>
      <td></td>
    </tr>

<script>
      function addNewCL() {
        const newRowTemplate = document.getElementById('new-row-template-CL');
        const newRow = newRowTemplate.cloneNode(true);
        newRow.removeAttribute('style');
    
        
        
    
        const currentLiabilitesRows = document.querySelectorAll('.current-liabilities-row');
        const lastCurrentLiabilitesRow = currentLiabilitesRows[currentLiabilitesRows.length - 1];
        lastCurrentLiabilitesRow.insertAdjacentElement('afterend', newRow);
      }
</script>

    <tr id="ttl-row" class="ttl-lr-row">
      <td>
        
        <button id="add-row-button-CL" class="btn btn-success" type="button" onclick="addNewCL()" style="display:none; float: right;" >Add</button>
      </td>
      <td></td>
      <td><strong>Current Liabilities</strong></td>
      <script>
        for (var i = 3; i <= 17; i++) {
          if (i >= 4 && i <= 15) {
            document.write(`<td id="local-revenue-total-${i}" class="collapsed" ></td>`);
          } else {
            document.write(`<td id="local-revenue-total-${i}" ></td>`);
          }
        }
      </script>
  </tr>


  

      {% for row in data_activitybs %}
      {% if row.Activity == 'AP' %}
      
      <tr id="row13-{{ forloop.counter }}" class="balancesheet-activity-row">
      <td>
        <a href=" {% url 'delete_bsa' row.obj row.Activity  %}" id="delete-container-{{ forloop.counter }}" style="display:none;"><i class="fas fa-times"></i></a>
      </td>
      <td>{{row.obj}}</td>
      <td>{{row.Description2}}</td>
      <td></td>
      <td class="collapsed right-align-td"><a href="#" class="viewgl_activitybs-link" data-obj="{{ row.obj }}"  data-yr="09">{{row.total_bal9}}</td>
      <td class="collapsed right-align-td"><a href="#" class="viewgl_activitybs-link" data-obj="{{ row.obj }}"  data-yr="10">{{row.total_bal10}}</td>
      <td class="collapsed right-align-td"><a href="#" class="viewgl_activitybs-link" data-obj="{{ row.obj }}"  data-yr="11">{{row.total_bal11}}</td>
      <td class="collapsed right-align-td"><a href="#" class="viewgl_activitybs-link" data-obj="{{ row.obj }}"  data-yr="12">{{row.total_bal12}}</td>
      <td class="collapsed right-align-td"><a href="#" class="viewgl_activitybs-link" data-obj="{{ row.obj }}"  data-yr="01">{{row.total_bal1}}</td>
      <td class="collapsed right-align-td"><a href="#" class="viewgl_activitybs-link" data-obj="{{ row.obj }}"  data-yr="02">{{row.total_bal2}}</td>
      <td class="collapsed right-align-td"><a href="#" class="viewgl_activitybs-link" data-obj="{{ row.obj }}"  data-yr="03">{{row.total_bal3}}</td>
      <td class="collapsed right-align-td"><a href="#" class="viewgl_activitybs-link" data-obj="{{ row.obj }}"  data-yr="04">{{row.total_bal4}}</td>
      <td class="collapsed right-align-td"><a href="#" class="viewgl_activitybs-link" data-obj="{{ row.obj }}"  data-yr="05">{{row.total_bal5}}</td>
      <td class="collapsed right-align-td"><a href="#" class="viewgl_activitybs-link" data-obj="{{ row.obj }}"  data-yr="06">{{row.total_bal6}}</td>
      <td class="collapsed right-align-td"><a href="#" class="viewgl_activitybs-link" data-obj="{{ row.obj }}"  data-yr="07">{{row.total_bal7}}</td>
      <td class="collapsed right-align-td"><a href="#" class="viewgl_activitybs-link" data-obj="{{ row.obj }}"  data-yr="08">{{row.total_bal8}}</td>
      <td class="right-align-td"></td>
      <td class="right-align-td"></td>
      </tr>
      
      {% endif %}
      {% endfor %}

      {% for row in data_balancesheet %}
        {% if row.Category == 'Liabilities and Net Assets' %}
        {% if row.Subcategory == 'Current Liabilities' %}
        {% if row.Activity == 'AP' %}
           
            <tr id="row3-{{ forloop.counter }}" class="current-liabilities-row">
              <td>
                <a href=" {% url 'delete_bs' row.Description row.Subcategory  %}" id="delete-container-{{ forloop.counter }}" style="display:none;"><i class="fas fa-times"></i></a>
                <button id="row13" class="expand-button"  type="button" onclick="toggleRow(13)" style=" float: left;">+</button>
              </td>
              <td>
                <input type="hidden" class="form-control" name="updatesub[]"  value="{{row.Subcategory}}">
                <input type="hidden" class="form-control" name="updatedesc[]"  value="{{row.Description}}">
              </td>
              <td>{{row.Description}} </td>
              <td id="value-cell-{{ forloop.counter }}" contenteditable="false" class="right-align-td">
                <input type="hidden" class="form-control" id="updatefye-{{ forloop.counter }}" name="updatefye[]" placeholder="Description"  value="{{ row.FYE }}">
                {{row.FYE}}
              
              </td>
              <td class="collapsed right-align-td">{{row.difference_9}}</td>
              <td class="collapsed right-align-td">{{row.difference_10}}</td>
              <td class="collapsed right-align-td">{{row.difference_11}}</td>
              <td class="collapsed right-align-td">{{row.difference_12}}</td>
              <td class="collapsed right-align-td">{{row.difference_1}}</td>
              <td class="collapsed right-align-td">{{row.difference_2}}</td>
              <td class="collapsed right-align-td">{{row.difference_3}}</td>
              <td class="collapsed right-align-td">{{row.difference_4}}</td>
              <td class="collapsed right-align-td">{{row.difference_5}}</td>
              <td class="collapsed right-align-td">{{row.difference_6}}</td>
              <td class="collapsed right-align-td"></td>
              <td class="collapsed right-align-td"></td>
              <td class="right-align-td">{{row.fytd}}</td>
              <td class="right-align-td">{{row.difference_6}}</td>
            </tr>
       
            {% endif %}  
            {% endif %}   
        {% endif %}
      {% endfor %}

      <!-- END OF AP-->


      

    {% for row in data_activitybs %}
    {% if row.Activity == 'Acc-Exp' %}
    
    <tr id="row14-{{ forloop.counter }}" class="balancesheet-activity-row">
    <td>
      <a href=" {% url 'delete_bsa' row.obj row.Activity  %}" id="delete-container-{{ forloop.counter }}" style="display:none;"><i class="fas fa-times"></i></a>
    </td>
    <td>{{row.obj}}</td>
    <td>{{row.Description2}}</td>
    <td></td>
    <td class="collapsed right-align-td"><a href="#" class="viewgl_activitybs-link" data-obj="{{ row.obj }}"  data-yr="09">{{row.total_bal9}}</td>
    <td class="collapsed right-align-td"><a href="#" class="viewgl_activitybs-link" data-obj="{{ row.obj }}"  data-yr="10">{{row.total_bal10}}</td>
    <td class="collapsed right-align-td"><a href="#" class="viewgl_activitybs-link" data-obj="{{ row.obj }}"  data-yr="11">{{row.total_bal11}}</td>
    <td class="collapsed right-align-td"><a href="#" class="viewgl_activitybs-link" data-obj="{{ row.obj }}"  data-yr="12">{{row.total_bal12}}</td>
    <td class="collapsed right-align-td"><a href="#" class="viewgl_activitybs-link" data-obj="{{ row.obj }}"  data-yr="01">{{row.total_bal1}}</td>
    <td class="collapsed right-align-td"><a href="#" class="viewgl_activitybs-link" data-obj="{{ row.obj }}"  data-yr="02">{{row.total_bal2}}</td>
    <td class="collapsed right-align-td"><a href="#" class="viewgl_activitybs-link" data-obj="{{ row.obj }}"  data-yr="03">{{row.total_bal3}}</td>
    <td class="collapsed right-align-td"><a href="#" class="viewgl_activitybs-link" data-obj="{{ row.obj }}"  data-yr="04">{{row.total_bal4}}</td>
    <td class="collapsed right-align-td"><a href="#" class="viewgl_activitybs-link" data-obj="{{ row.obj }}"  data-yr="05">{{row.total_bal5}}</td>
    <td class="collapsed right-align-td"><a href="#" class="viewgl_activitybs-link" data-obj="{{ row.obj }}"  data-yr="06">{{row.total_bal6}}</td>
    <td class="collapsed right-align-td"><a href="#" class="viewgl_activitybs-link" data-obj="{{ row.obj }}"  data-yr="07">{{row.total_bal7}}</td>
    <td class="collapsed right-align-td"><a href="#" class="viewgl_activitybs-link" data-obj="{{ row.obj }}"  data-yr="08">{{row.total_bal8}}</td>
    <td class="right-align-td"></td>
    <td class="right-align-td"></td>
    </tr>
    
    {% endif %}
    {% endfor %}

    {% for row in data_balancesheet %}
      {% if row.Category == 'Liabilities and Net Assets' %}
      {% if row.Subcategory == 'Current Liabilities' %}
      {% if row.Activity == 'Acc-Exp' %}
         
          <tr id="row3-{{ forloop.counter }}" class="current-liabilities-row">
            <td>
              <a href=" {% url 'delete_bs' row.Description row.Subcategory  %}" id="delete-container-{{ forloop.counter }}" style="display:none;"><i class="fas fa-times"></i></a>
              <button id="row14" class="expand-button"  type="button" onclick="toggleRow(14)" style=" float: left;">+</button>
            </td>
            <td>
              <input type="hidden" class="form-control" name="updatesub[]"  value="{{row.Subcategory}}">
              <input type="hidden" class="form-control" name="updatedesc[]"  value="{{row.Description}}">
            </td>
            <td>{{row.Description}} </td>
            <td id="value-cell-{{ forloop.counter }}" contenteditable="false" class="right-align-td">
              <input type="hidden" class="form-control" id="updatefye-{{ forloop.counter }}" name="updatefye[]" placeholder="Description"  value="{{ row.FYE }}">
              {{row.FYE}}
            
            </td>
            <td class="collapsed right-align-td">{{row.difference_9}}</td>
            <td class="collapsed right-align-td">{{row.difference_10}}</td>
            <td class="collapsed right-align-td">{{row.difference_11}}</td>
            <td class="collapsed right-align-td">{{row.difference_12}}</td>
            <td class="collapsed right-align-td">{{row.difference_1}}</td>
            <td class="collapsed right-align-td">{{row.difference_2}}</td>
            <td class="collapsed right-align-td">{{row.difference_3}}</td>
            <td class="collapsed right-align-td">{{row.difference_4}}</td>
            <td class="collapsed right-align-td">{{row.difference_5}}</td>
            <td class="collapsed right-align-td">{{row.difference_6}}</td>
            <td class="collapsed right-align-td"></td>
            <td class="collapsed right-align-td"></td>
            <td class="right-align-td">{{row.fytd}}</td>
            <td class="right-align-td">{{row.difference_6}}</td>
          </tr>
     
          {% endif %}  
          {% endif %}   
      {% endif %}
    {% endfor %}
    <!-- END OF ACC EXP-->

    

  {% for row in data_activitybs %}
  {% if row.Activity == 'OtherLab' %}
  
  <tr id="row15-{{ forloop.counter }}" class="balancesheet-activity-row">
  <td>
    <a href=" {% url 'delete_bsa' row.obj row.Activity  %}" id="delete-container-{{ forloop.counter }}" style="display:none;"><i class="fas fa-times"></i></a>
  </td>
  <td>{{row.obj}}</td>
  <td>{{row.Description2}}</td>
  <td></td>
  <td class="collapsed right-align-td"><a href="#" class="viewgl_activitybs-link" data-obj="{{ row.obj }}"  data-yr="09">{{row.total_bal9}}</td>
  <td class="collapsed right-align-td"><a href="#" class="viewgl_activitybs-link" data-obj="{{ row.obj }}"  data-yr="10">{{row.total_bal10}}</td>
  <td class="collapsed right-align-td"><a href="#" class="viewgl_activitybs-link" data-obj="{{ row.obj }}"  data-yr="11">{{row.total_bal11}}</td>
  <td class="collapsed right-align-td"><a href="#" class="viewgl_activitybs-link" data-obj="{{ row.obj }}"  data-yr="12">{{row.total_bal12}}</td>
  <td class="collapsed right-align-td"><a href="#" class="viewgl_activitybs-link" data-obj="{{ row.obj }}"  data-yr="01">{{row.total_bal1}}</td>
  <td class="collapsed right-align-td"><a href="#" class="viewgl_activitybs-link" data-obj="{{ row.obj }}"  data-yr="02">{{row.total_bal2}}</td>
  <td class="collapsed right-align-td"><a href="#" class="viewgl_activitybs-link" data-obj="{{ row.obj }}"  data-yr="03">{{row.total_bal3}}</td>
  <td class="collapsed right-align-td"><a href="#" class="viewgl_activitybs-link" data-obj="{{ row.obj }}"  data-yr="04">{{row.total_bal4}}</td>
  <td class="collapsed right-align-td"><a href="#" class="viewgl_activitybs-link" data-obj="{{ row.obj }}"  data-yr="05">{{row.total_bal5}}</td>
  <td class="collapsed right-align-td"><a href="#" class="viewgl_activitybs-link" data-obj="{{ row.obj }}"  data-yr="06">{{row.total_bal6}}</td>
  <td class="collapsed right-align-td"><a href="#" class="viewgl_activitybs-link" data-obj="{{ row.obj }}"  data-yr="07">{{row.total_bal7}}</td>
  <td class="collapsed right-align-td"><a href="#" class="viewgl_activitybs-link" data-obj="{{ row.obj }}"  data-yr="08">{{row.total_bal8}}</td>
  <td class="right-align-td"></td>
  <td class="right-align-td"></td>
  </tr>
  
  {% endif %}
  {% endfor %}

  {% for row in data_balancesheet %}
    {% if row.Category == 'Liabilities and Net Assets' %}
    {% if row.Subcategory == 'Current Liabilities' %}
    {% if row.Activity == 'OtherLab' %}
       
        <tr id="row3-{{ forloop.counter }}" class="current-liabilities-row">
          <td>
            <a href=" {% url 'delete_bs' row.Description row.Subcategory  %}" id="delete-container-{{ forloop.counter }}" style="display:none;"><i class="fas fa-times"></i></a>
            <button id="row15" class="expand-button"  type="button" onclick="toggleRow(15)" style=" float: left;">+</button>
          </td>
          <td>
            <input type="hidden" class="form-control" name="updatesub[]"  value="{{row.Subcategory}}">
            <input type="hidden" class="form-control" name="updatedesc[]"  value="{{row.Description}}">
          </td>
          <td>{{row.Description}} </td>
          <td id="value-cell-{{ forloop.counter }}" contenteditable="false" class="right-align-td">
            <input type="hidden" class="form-control" id="updatefye-{{ forloop.counter }}" name="updatefye[]" placeholder="Description"  value="{{ row.FYE }}">
            {{row.FYE}}
          
          </td>
          <td class="collapsed right-align-td">{{row.difference_9}}</td>
          <td class="collapsed right-align-td">{{row.difference_10}}</td>
          <td class="collapsed right-align-td">{{row.difference_11}}</td>
          <td class="collapsed right-align-td">{{row.difference_12}}</td>
          <td class="collapsed right-align-td">{{row.difference_1}}</td>
          <td class="collapsed right-align-td">{{row.difference_2}}</td>
          <td class="collapsed right-align-td">{{row.difference_3}}</td>
          <td class="collapsed right-align-td">{{row.difference_4}}</td>
          <td class="collapsed right-align-td">{{row.difference_5}}</td>
          <td class="collapsed right-align-td">{{row.difference_6}}</td>
          <td class="collapsed right-align-td"></td>
          <td class="collapsed right-align-td"></td>
          <td class="right-align-td">{{row.fytd}}</td>
          <td class="right-align-td">{{row.difference_6}}</td>
        </tr>
   
        {% endif %}  
        {% endif %}   
    {% endif %}
  {% endfor %}
  <!-- END OF OTHERLAB-->


      


  {% for row in data_activitybs %}
  {% if row.Activity == 'Debt-C' %}
  
  <tr id="row16-{{ forloop.counter }}" class="balancesheet-activity-row">
  <td>
    <a href=" {% url 'delete_bsa' row.obj row.Activity  %}" id="delete-container-{{ forloop.counter }}" style="display:none;"><i class="fas fa-times"></i></a>
  </td>
  <td>{{row.obj}}</td>
  <td>{{row.Description2}} </td>
  <td></td>
  <td class="collapsed right-align-td"><a href="#" class="viewgl_activitybs-link" data-obj="{{ row.obj }}"  data-yr="09">{{row.total_bal9}}</td>
  <td class="collapsed right-align-td"><a href="#" class="viewgl_activitybs-link" data-obj="{{ row.obj }}"  data-yr="10">{{row.total_bal10}}</td>
  <td class="collapsed right-align-td"><a href="#" class="viewgl_activitybs-link" data-obj="{{ row.obj }}"  data-yr="11">{{row.total_bal11}}</td>
  <td class="collapsed right-align-td"><a href="#" class="viewgl_activitybs-link" data-obj="{{ row.obj }}"  data-yr="12">{{row.total_bal12}}</td>
  <td class="collapsed right-align-td"><a href="#" class="viewgl_activitybs-link" data-obj="{{ row.obj }}"  data-yr="01">{{row.total_bal1}}</td>
  <td class="collapsed right-align-td"><a href="#" class="viewgl_activitybs-link" data-obj="{{ row.obj }}"  data-yr="02">{{row.total_bal2}}</td>
  <td class="collapsed right-align-td"><a href="#" class="viewgl_activitybs-link" data-obj="{{ row.obj }}"  data-yr="03">{{row.total_bal3}}</td>
  <td class="collapsed right-align-td"><a href="#" class="viewgl_activitybs-link" data-obj="{{ row.obj }}"  data-yr="04">{{row.total_bal4}}</td>
  <td class="collapsed right-align-td"><a href="#" class="viewgl_activitybs-link" data-obj="{{ row.obj }}"  data-yr="05">{{row.total_bal5}}</td>
  <td class="collapsed right-align-td"><a href="#" class="viewgl_activitybs-link" data-obj="{{ row.obj }}"  data-yr="06">{{row.total_bal6}}</td>
  <td class="collapsed right-align-td"><a href="#" class="viewgl_activitybs-link" data-obj="{{ row.obj }}"  data-yr="07">{{row.total_bal7}}</td>
  <td class="collapsed right-align-td"><a href="#" class="viewgl_activitybs-link" data-obj="{{ row.obj }}"  data-yr="08">{{row.total_bal8}}</td>
  <td class="right-align-td"></td>
  <td class="right-align-td"></td>
  </tr>
  
  {% endif %}
  {% endfor %}

  {% for row in data_balancesheet %}
    {% if row.Category == 'Liabilities and Net Assets' %}
    {% if row.Subcategory == 'Current Liabilities' %}
    {% if row.Activity == 'Debt-C' %}
       
        <tr id="row3-{{ forloop.counter }}" class="current-liabilities-row">
          <td>
            <a href="{% url 'delete_bs' row.Description row.Subcategory %}" id="delete-container-{{ forloop.counter }}" style="display:none;"><i class="fas fa-times"></i></a>
            {% if  forloop.first %}
            <button id="row15" class="expand-button"  type="button" onclick="toggleRow(15)" style=" float: left;">+</button>
   

        {% endif %}

          </td>
          <td>
            <input type="hidden" class="form-control" name="updatesub[]"  value="{{row.Subcategory}}">
            <input type="hidden" class="form-control" name="updatedesc[]"  value="{{row.Description}}">
          </td>
          <td>{{row.Description}}</td>
          <td id="value-cell-{{ forloop.counter }}" contenteditable="false" class="right-align-td">
            <input type="hidden" class="form-control" id="updatefye-{{ forloop.counter }}" name="updatefye[]" placeholder="Description"  value="{{ row.FYE }}">
            {{row.FYE}}
          
          </td>
          <td class="collapsed right-align-td">{{row.difference_9}}</td>
          <td class="collapsed right-align-td">{{row.difference_10}}</td>
          <td class="collapsed right-align-td">{{row.difference_11}}</td>
          <td class="collapsed right-align-td">{{row.difference_12}}</td>
          <td class="collapsed right-align-td">{{row.difference_1}}</td>
          <td class="collapsed right-align-td">{{row.difference_2}}</td>
          <td class="collapsed right-align-td">{{row.difference_3}}</td>
          <td class="collapsed right-align-td">{{row.difference_4}}</td>
          <td class="collapsed right-align-td">{{row.difference_5}}</td>
          <td class="collapsed right-align-td">{{row.difference_6}}</td>
          <td class="collapsed right-align-td"></td>
          <td class="collapsed right-align-td"></td>
          <td class="right-align-td">{{row.fytd}}</td>
          <td class="right-align-td">{{row.difference_6}}</td>
        </tr>
        {% endif %}  
        {% endif %}   
    {% endif %}
{% endfor %}
  <!-- END OF DebtC-->

      <tr id="ttl-row" >
          <td>
           </td>
           <td></td>
           <td><strong>Total Current Liabilities</strong></td>
           <script>
          for (var i = 3; i <= 17; i++) {
            if (i >= 4 && i <= 15) {
              document.write(`<td id="current-liabilities-total-${i}" class="collapsed right-align-td" ></td>`);
            } else {
              document.write(`<td id="current-liabilities-total-${i}" class="right-align-td"></td>`);
            }
          }
        </script>
    </tr>


    <tr id="new-row-template-LTD" style="display: none;">
      <td></td>
      <td ><select class="form-control" name="Activity_LTD[]">
            
        <option value=""></option>
    {% for activity in bs_activity_list %}
        <option value="{{ activity }}">{{activity }}</option>
    {% endfor %}    
      </select></td>
      <td class="width20"><input type="text" class="form-control" name="Description_LTD[]" placeholder="Description"></td>
      <td class="width20"><input type="text" class="form-control" name="fye_LTD[]" placeholder="FYE" oninput="validateBudgetInput(event)"></td>
      <td></td>
    </tr>

<script>
      function addNewLTD() {
        const newRowTemplate = document.getElementById('new-row-template-LTD');
        const newRow = newRowTemplate.cloneNode(true);
        newRow.removeAttribute('style');
    
        
        
    
        const LTDRows = document.querySelectorAll('.total-liabilities-row');
        const lastLTDRow = LTDRows[LTDRows.length - 1];
        lastLTDRow.insertAdjacentElement('afterend', newRow);
      }
</script>
    
    <tr id="ttl-row" class="ttl-lr-row">
        <td>

          <button id="add-row-button-LTD" class="btn btn-success" type="button" onclick="addNewLTD()" style="display:none; float: right;" >Add</button>
        </td>
        <td></td>
        <td><strong>Long Term Debt</strong></td>
        <script>
          for (var i = 3; i <= 17; i++) {
            if (i >= 4 && i <= 15) {
              document.write(`<td id="local-revenue-total-${i}" class="collapsed" ></td>`);
            } else {
              document.write(`<td id="local-revenue-total-${i}" ></td>`);
            }
          }
        </script>
    </tr>

    

      {% for row in data_activitybs %}
      {% if row.Activity == 'LTD' %}
      
      <tr id="row17-{{ forloop.counter }}" class="balancesheet-activity-row">
      <td>
        <a href=" {% url 'delete_bsa' row.obj row.Activity  %}" id="delete-container-{{ forloop.counter }}" style="display:none;"><i class="fas fa-times"></i></a>
      </td>
      <td>{{row.obj}}</td>
      <td>{{row.Description2}}</td>
      <td></td>
      <td class="collapsed right-align-td"><a href="#" class="viewgl_activitybs-link" data-obj="{{ row.obj }}"  data-yr="09">{{row.total_bal9}}</td>
      <td class="collapsed right-align-td"><a href="#" class="viewgl_activitybs-link" data-obj="{{ row.obj }}"  data-yr="10">{{row.total_bal10}}</td>
      <td class="collapsed right-align-td"><a href="#" class="viewgl_activitybs-link" data-obj="{{ row.obj }}"  data-yr="11">{{row.total_bal11}}</td>
      <td class="collapsed right-align-td"><a href="#" class="viewgl_activitybs-link" data-obj="{{ row.obj }}"  data-yr="12">{{row.total_bal12}}</td>
      <td class="collapsed right-align-td"><a href="#" class="viewgl_activitybs-link" data-obj="{{ row.obj }}"  data-yr="01">{{row.total_bal1}}</td>
      <td class="collapsed right-align-td"><a href="#" class="viewgl_activitybs-link" data-obj="{{ row.obj }}"  data-yr="02">{{row.total_bal2}}</td>
      <td class="collapsed right-align-td"><a href="#" class="viewgl_activitybs-link" data-obj="{{ row.obj }}"  data-yr="03">{{row.total_bal3}}</td>
      <td class="collapsed right-align-td"><a href="#" class="viewgl_activitybs-link" data-obj="{{ row.obj }}"  data-yr="04">{{row.total_bal4}}</td>
      <td class="collapsed right-align-td"><a href="#" class="viewgl_activitybs-link" data-obj="{{ row.obj }}"  data-yr="05">{{row.total_bal5}}</td>
      <td class="collapsed right-align-td"><a href="#" class="viewgl_activitybs-link" data-obj="{{ row.obj }}"  data-yr="06">{{row.total_bal6}}</td>
      <td class="collapsed right-align-td"><a href="#" class="viewgl_activitybs-link" data-obj="{{ row.obj }}"  data-yr="07">{{row.total_bal7}}</td>
      <td class="collapsed right-align-td"><a href="#" class="viewgl_activitybs-link" data-obj="{{ row.obj }}"  data-yr="08">{{row.total_bal8}}</td>
      <td class="right-align-td"></td>
      <td class="right-align-td"></td>
      </tr>
      
      {% endif %}
      {% endfor %}

      {% for row in data_balancesheet %}
        {% if row.Category == 'Debt' %}
        {% if row.Subcategory == 'Long Term Debt' %}
        {% if row.Activity == 'LTD' %}
            
            <tr class="total-liabilities-row">
              <td>
                <a href=" {% url 'delete_bs' row.Description row.Subcategory  %}" id="delete-container-{{ forloop.counter }}" style="display:none;"><i class="fas fa-times"></i></a>
                <button id="row17" class="expand-button"  type="button" onclick="toggleRow(17)" style=" float: left;">+</button>
              </td>
              <td>
                <input type="hidden" class="form-control" name="updatesub[]"  value="{{row.Subcategory}}">
                <input type="hidden" class="form-control" name="updatedesc[]"  value="{{row.Description}}">
              </td>
              <td>{{row.Description}}</td>
              <td id="value-cell-{{ forloop.counter }}" contenteditable="false" class="right-align-td">
                <input type="hidden" class="form-control" id="updatefye-{{ forloop.counter }}" name="updatefye[]" placeholder="Description"  value="{{ row.FYE }}">
                {{row.FYE}}
              
              </td>
              <td class="collapsed right-align-td">{{row.difference_9}}</td>
              <td class="collapsed right-align-td">{{row.difference_10}}</td>
              <td class="collapsed right-align-td">{{row.difference_11}}</td>
              <td class="collapsed right-align-td">{{row.difference_12}}</td>
              <td class="collapsed right-align-td">{{row.difference_1}}</td>
              <td class="collapsed right-align-td">{{row.difference_2}}</td>
              <td class="collapsed right-align-td">{{row.difference_3}}</td>
              <td class="collapsed right-align-td">{{row.difference_4}}</td>
              <td class="collapsed right-align-td">{{row.difference_5}}</td>
              <td class="collapsed right-align-td">{{row.difference_6}}</td>
              <td class="collapsed right-align-td"></td>
              <td class="collapsed right-align-td"></td>
              <td class="right-align-td">{{row.fytd}}</td>
              <td class="right-align-td">{{row.difference_6}}</td>
            </tr>
            {% endif %}   
            
            {% endif %}   
        {% endif %}
      {% endfor %}
        
      <tr id="ttl-row" class="ttl-lr-row">
        <td></td>
        <td></td>
        <td><strong>Total Liabilities</strong></td>
        <script>
          for (var i = 3; i <= 17; i++) {
            if (i >= 4 && i <= 15) {
              document.write(`<td id="total-liabilities-total-${i}" class="collapsed right-align-td" ></td>`);
            } else {
              document.write(`<td id="total-liabilities-total-${i}" class="right-align-td"></td>`);
            }
          }
        </script>
      </tr>

    {% for row in data_balancesheet %}
        {% if row.Category == 'Net Assets' %}
        {% if row.Activity == 'Equity' %}
            <tr class="net-assets-row">
              <td>
             
              </td>
              <td>
                <input type="hidden" class="form-control" name="updatesub[]"  value="{{row.Subcategory}}">
                <input type="hidden" class="form-control" name="updatedesc[]"  value="{{row.Description}}">
              </td>
              <td><strong>Net Assets<strong></td>
              <td id="value-cell-{{ forloop.counter }}" contenteditable="false" class="right-align-td">
                <input type="hidden" class="form-control" id="updatefye-{{ forloop.counter }}" name="updatefye[]" placeholder="Description"  value="{{ row.FYE }}">
                {{row.FYE}}
              
              </td>
              <td class="collapsed right-align-td">{{row.difference_9}}</td>
              <td class="collapsed right-align-td">{{row.difference_10}}</td>
              <td class="collapsed right-align-td">{{row.difference_11}}</td>
              <td class="collapsed right-align-td">{{row.difference_12}}</td>
              <td class="collapsed right-align-td">{{row.difference_1}}</td>
              <td class="collapsed right-align-td">{{row.difference_2}}</td>
              <td class="collapsed right-align-td">{{row.difference_3}}</td>
              <td class="collapsed right-align-td">{{row.difference_4}}</td>
              <td class="collapsed right-align-td">{{row.difference_5}}</td>
              <td class="collapsed right-align-td">{{row.difference_6}}</td>
              <td class="collapsed right-align-td"></td>
              <td class="collapsed right-align-td"></td>
              <td class="right-align-td">{{row.fytd}}</td>
              <td class="right-align-td">{{row.difference_6}}</td>
            </tr>
            {% endif %}
            {% endif %}  
          {% endfor %}
      
      <tr id="ttl-row" class="ttl-lr-row">
        <td></td>
        <td></td>
        <td><strong>Total Liabilities and Net Assets</strong></td>
        <script>
          for (var i = 3; i <= 17; i++) {
            if (i >= 4 && i <= 15) {
              document.write(`<td id="liabilitiesandnet-total-${i}" class="collapsed right-align-td" ></td>`);
            } else {
              document.write(`<td id="liabilitiesandnet-total-${i}" class="right-align-td"></td>`);
            }
          }
        </script>
    </tr>
  

</tbody>
</table>
</form>
</div>


<script>

  

  document.addEventListener("DOMContentLoaded", function () {
 
    var modal = document.getElementById("myModal");

      
      var modalTableBody = document.getElementById("modal-table-body");

   
      function populateModal(data) {
        
        modalTableBody.innerHTML = "";
      
        
        data.glbs_data.forEach(function (row) {
          var newRow = document.createElement("tr");
          newRow.innerHTML = `
            <td class="fund-td">${row.fund}</td>
            <td class="fund-td">${row.func}</td>
            <td>${row.obj}</td>
            <td>${row.org}</td>
            <td>${row.fscl_yr}</td>
            <td>${row.pgm}</td>
           
            <td>${row.projDtl}</td>
            <td>${row.AcctDescr}</td>
            <td>${row.Number}</td>
            <td style="white-space: nowrap;">${row.Date}</td>
            <td>${row.AcctPer}</td>
            
            <td>${row.Real}</td>
            
            
            <td>${row.Expend}</td>
            <td>${row.Bal}</td>
            <td style="white-space: nowrap;">${row.WorkDescr}</td>
            <td>${row.Type}</td>
            
          `;
          modalTableBody.appendChild(newRow);
        });

        var totalRow = document.createElement("tr");
        totalRow.innerHTML = `
          <td colspan="13" style="text-align: right;">Total Balance</td>
          <td>$${data.total_bal}</td>
          <td colspan="2"></td>
        `;
        modalTableBody.appendChild(totalRow);

      }

    function fetchDataAndPopulateModal(obj, yr) {
      fetch(`/viewgl_activitybs/${obj}/${yr}/`)
        .then(function (response) {
          
          return response.json();
        })
        .then(function (data) {
     
          if (data.status === "success") {
            
            populateModal(data.data , data.total_bal);
            
            modal.style.display = "block";
          } else {

          }
        })
        .catch(function (error) {
  
        });
    }

   
    var viewGLLinks = document.querySelectorAll(".viewgl_activitybs-link");
    viewGLLinks.forEach(function (link) {
      link.addEventListener("click", function (event) {
        event.preventDefault();
        
        var obj = link.dataset.obj;
        var yr = link.dataset.yr;
        fetchDataAndPopulateModal(obj , yr);
      });
    });

    
    var closeButton = modal.querySelector(".modal-footer button");
    closeButton.addEventListener("click", function () {
      modal.style.display = "none";
    });
  });

  function toggleColumns() {
    var toggleButton = document.getElementById("toggle-button");
    var collapsedColumns = document.getElementsByClassName("collapsed");
    for (var i = 0; i < collapsedColumns.length; i++) {
      if (collapsedColumns[i].style.display === "none") {
        collapsedColumns[i].style.display = "table-cell";
        toggleButton.innerHTML = "-";
      } else {
        collapsedColumns[i].style.display = "none";
        toggleButton.innerHTML = "+";
      }
    }
  }




    
  function validateBudgetInput(event) {
    const input = event.target;
    const value = input.value;

    
    const regex = /^[0-9.]*$/;

    
    if (!regex.test(value)) {
        
        input.value = value.replace(/[^0-9.]/g, '');
    }
}
  
   
    
  function extractNumericValue(content) {
    const match = content.match(/\(([^)]+)\)/);
    if (match) {
      const numericValue = parseFloat(match[1].replace(/,/g, '').trim());
      return isNaN(numericValue) ? 0 : -numericValue;
    } else {
      const numericValue = parseFloat(content.replace(/,/g, '').trim());
      return isNaN(numericValue) ? 0 : numericValue;
    }
  }

  /* --------------current assets total function ------------------*/
  function calculateCurrentAssets() {
    const rows = document.querySelectorAll('.current-assets-row');
    const totalCells = [];
  
    
    const totalCellIds = [3,4, 5,6,7,8,9,10,11,12,13,14,15,16,17];
  
    for (let i = 0; i < totalCellIds.length; i++) {
      const cellId = totalCellIds[i];
      const totalCell = document.getElementById(`current-assets-total-${cellId}`);
      
      totalCells.push(totalCell);
      
    }
  
    let columnTotals = new Array(totalCells.length).fill(0);
  
    rows.forEach(row => {
      const cells = row.cells;
      for (let i = 3; i < cells.length; i++) {
        const cell = cells[i];
        const value = extractNumericValue(cell.textContent);
        if (!isNaN(value)) {
          for (let j = 0; j < totalCells.length; j++) {
            if (i === totalCellIds[j]) {
              columnTotals[j] += value;
              break;
            }
          }
        }
      }
    });
  
    for (let i = 0; i < totalCells.length; i++) {
      const totalCell = totalCells[i];
      const columnTotal = parseInt(columnTotals[i]);
      totalCell.textContent = columnTotal !== 0 ?  columnTotal.toLocaleString() : '';
    }
  }

 /* --------------capital assets total function ------------------*/
  function calculateCapitalAssets() {
    const rows = document.querySelectorAll('.capital-assets-row');
    const totalCells = [];
  
    
    const totalCellIds = [3,4, 5,6,7,8,9,10,11,12,13,14,15,16,17];
  
    for (let i = 0; i < totalCellIds.length; i++) {
      const cellId = totalCellIds[i];
      const totalCell = document.getElementById(`capital-assets-total-${cellId}`);
      
      totalCells.push(totalCell);
      
    }
  
    let columnTotals = new Array(totalCells.length).fill(0);
  
    rows.forEach(row => {
      const cells = row.cells;
      for (let i = 3; i < cells.length; i++) {
        const cell = cells[i];
        const value = extractNumericValue(cell.textContent);
        if (!isNaN(value)) {
          for (let j = 0; j < totalCells.length; j++) {
            if (i === totalCellIds[j]) {
              columnTotals[j] += value;
              break;
            }
          }
        }
      }
    });
  
    for (let i = 0; i < totalCells.length; i++) {
      const totalCell = totalCells[i];
      const columnTotal = parseInt(columnTotals[i]);
      totalCell.textContent = columnTotal !== 0 ?  columnTotal.toLocaleString() : '';
    }
  }

  /* -------------- total  assets function ------------------*/
  function calculateTotalAssets() {
    const rows = document.querySelectorAll('.capital-assets-row,.current-assets-row');
    const totalCells = [];
  
    const totalCellIds = [3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15,16, 17];
  
    for (let i = 0; i < totalCellIds.length; i++) {
      const cellId = totalCellIds[i];
      const totalCell = document.getElementById(`total-assets-total-${cellId}`);

      totalCells.push(totalCell);
    }
  
    let columnTotals = new Array(totalCells.length).fill(0);
  
    rows.forEach(row => {
      const cells = row.cells;
      for (let i = 3; i < cells.length; i++) {
        const cell = cells[i];
        const value = extractNumericValue(cell.textContent);
        if (!isNaN(value)) {
          for (let j = 0; j < totalCells.length; j++) {
            if (i === totalCellIds[j]) {
              columnTotals[j] += value;
              break;
            }
          }
        }
      }
    });
  
    for (let i = 0; i < totalCells.length; i++) {
      const totalCell = totalCells[i];
      const columnTotal = columnTotals[i]; // Don't parse the integer value here
      totalCell.textContent = columnTotal !== 0 ? '$' + columnTotal.toLocaleString() : '';
    }
  }

  /* --------------total current Liabilities function ------------------*/
  function calculateCurrentLiabilities() {
    const rows = document.querySelectorAll('.current-liabilities-row');
    const totalCells = [];
  
    
    const totalCellIds = [3,4, 5,6,7,8,9,10,11,12,13,14,15,16,17];
  
    for (let i = 0; i < totalCellIds.length; i++) {
      const cellId = totalCellIds[i];
      const totalCell = document.getElementById(`current-liabilities-total-${cellId}`);
      
      totalCells.push(totalCell);
      
    }
  
    let columnTotals = new Array(totalCells.length).fill(0);
  
    rows.forEach(row => {
      const cells = row.cells;
      for (let i = 3; i < cells.length; i++) {
        const cell = cells[i];
        const value = extractNumericValue(cell.textContent);
        if (!isNaN(value)) {
          for (let j = 0; j < totalCells.length; j++) {
            if (i === totalCellIds[j]) {
              columnTotals[j] += value;
              break;
            }
          }
        }
      }
    });
  
    for (let i = 0; i < totalCells.length; i++) {
      const totalCell = totalCells[i];
    const columnTotal = parseInt(columnTotals[i]);
    const formattedTotal = columnTotal < 0 ? `(${Math.abs(columnTotal).toLocaleString()})` : columnTotal.toLocaleString();
    totalCell.textContent = columnTotal !== 0 ? formattedTotal : '';
   }
  }


  /* --------------total  Liabilities function ------------------*/
  function calculateTotalLiabilities() {
    const rows = document.querySelectorAll('.total-liabilities-row,.current-liabilities-row');
    const totalCells = [];
  
    
    const totalCellIds = [3,4, 5,6,7,8,9,10,11,12,13,14,15,16,17];
  
    for (let i = 0; i < totalCellIds.length; i++) {
      const cellId = totalCellIds[i];
      const totalCell = document.getElementById(`total-liabilities-total-${cellId}`);
      
      totalCells.push(totalCell);
      
    }
  
    let columnTotals = new Array(totalCells.length).fill(0);
  
    rows.forEach(row => {
      const cells = row.cells;
      for (let i = 3; i < cells.length; i++) {
        const cell = cells[i];
        const value = extractNumericValue(cell.textContent);
        if (!isNaN(value)) {
          for (let j = 0; j < totalCells.length; j++) {
            if (i === totalCellIds[j]) {
              columnTotals[j] += value;
              break;
            }
          }
        }
      }
    });
  
    for (let i = 0; i < totalCells.length; i++) {
      const totalCell = totalCells[i];
    const columnTotal = parseInt(columnTotals[i]);
    const formattedTotal = columnTotal < 0 ? `(${Math.abs(columnTotal).toLocaleString()})` : columnTotal.toLocaleString();
    totalCell.textContent = columnTotal !== 0 ? formattedTotal : '';
  }
  }


  /* --------------total  Liabilities and nets assets function ------------------*/
  function calculateTotalLiabilitiesAndNetAssets() {
    const rows = document.querySelectorAll('.net-assets-row, .total-liabilities-row, .current-liabilities-row');
    const totalCells = [];
  
    
    const totalCellIds = [3,4, 5,6,7,8,9,10,11,12,13,14,15,16,17];
  
    for (let i = 0; i < totalCellIds.length; i++) {
      const cellId = totalCellIds[i];
      const totalCell = document.getElementById(`liabilitiesandnet-total-${cellId}`);
      
      totalCells.push(totalCell);
      
    }
  
    let columnTotals = new Array(totalCells.length).fill(0);
  
    rows.forEach(row => {
      const cells = row.cells;
      for (let i = 3; i < cells.length; i++) {
        const cell = cells[i];
        const value = extractNumericValue(cell.textContent);
        if (!isNaN(value)) {
          for (let j = 0; j < totalCells.length; j++) {
            if (i === totalCellIds[j]) {
              columnTotals[j] += value;
              break;
            }
          }
        }
      }
    });
  
    for (let i = 0; i < totalCells.length; i++) {
      const totalCell = totalCells[i];
      const columnTotal = parseInt(columnTotals[i]);
      totalCell.textContent = columnTotal !== 0 ? '$' + columnTotal.toLocaleString() : '';
    }
  }

  
  function calculateFYTD() {
    const rows = document.querySelectorAll('.balancesheet-activity-row');
  
    rows.forEach(row => {
      const cells = row.cells;
      let rowTotal = 0;
      for (let i = 4; i <= 15; i++) {
        const cellValue = extractNumericValue(cells[i].textContent);
        if (!isNaN(cellValue)) {
          rowTotal += cellValue;
        }
      }
  
      
      
      const formattedTotal = rowTotal < 0 ? `(${Math.abs(rowTotal).toLocaleString()})` : rowTotal.toLocaleString();
      cells[16].textContent = rowTotal !== 0 ? formattedTotal : '';
      cells[17].textContent = rowTotal !== 0 ? formattedTotal : '';
    });
  }


  
  
  
        
        

  var updateValuesArray = [];

  //---------------- update for local revenue, spr , fpr ------------------
  function updateBS(event) {
   var tdElement = event.target;
   var rowNumber = tdElement.id.split("-")[2];
   var updateValueInput = document.getElementById("updatefye-" + rowNumber);
 
   var cellContent = tdElement.innerText.trim();


   var cleanedValue = cellContent.replace(/[^0-9.]/g, '');
 
   if (cleanedValue === "" || isNaN(parseFloat(cleanedValue))) {
     if (updateValueInput) {
       updateValueInput.value = 0; // Set to an empty string when cell is empty or not a number
     }
   } else {
     var value = parseFloat(cleanedValue);
     
 
     if (!isNaN(value) || value === 0) {
       if (updateValueInput) {
       
 
         updateValueInput.value = value;
       }
     } else {
       if (updateValueInput) {

 
         updateValueInput.value = 0;
       }
     }
 
     // Update the value in the updateValuesArray based on the rowNumber
     updateValuesArray[rowNumber - 1] = !isNaN(value) ? value : "";
   }
 }

  var tbodyElements = document.querySelectorAll('.current-assets-row, .capital-assets-row, .current-liabilities-row, .total-liabilities-row, .net-assets-row ');
tbodyElements.forEach(function(tbodyElement) {
  tbodyElement.addEventListener("input", updateBS);
});
var tdElements = document.querySelectorAll('.current-assets-row td[contenteditable], .capital-assets-row td[contenteditable], .current-liabilities-row td[contenteditable], .total-liabilities-row td[contenteditable], .net-assets-row td[contenteditable] ');
tdElements.forEach(function(tdElement) {
  var rowNumber = tdElement.id.split("-")[2];
  updateBS({ target: tdElement });

});

function hideRowsByClass(className) {
  const rows = document.querySelectorAll(className);
  rows.forEach(row => {
    row.style.display = 'none';
  });
}

function hideRowsOnLoad() {
  const collapsedRows = document.querySelectorAll('.collapsed');
  collapsedRows.forEach(row => {
    row.style.display = 'none';
  });

  // Hide local revenue rows
  hideRowsByClass('.balancesheet-activity-row');
  // Hide state program revenue rows

}


  window.addEventListener('DOMContentLoaded', () => {
    hideRowsOnLoad();
  
      const editableCells = document.querySelectorAll('.current-assets-row td[contenteditable]');
      
      editableCells.forEach(cell => {
        cell.addEventListener('input', () => {
          calculateCurrentAssets();
          calculateCapitalAssets();
          calculateTotalAssets();
          calculateCurrentLiabilities();
          calculateTotalLiabilities();
          calculateTotalLiabilitiesAndNetAssets();
          calculateFYTD();
          
        
          
          
        });
      });
      
      
      calculateCurrentAssets();
      calculateCapitalAssets();
      calculateTotalAssets();
      calculateCurrentLiabilities();
      calculateTotalLiabilities();
      calculateTotalLiabilitiesAndNetAssets();
      calculateFYTD();
      
  });




</script>
{% comment %} <script src="{% static 'js/bs_advantage.js' %}"></script> {% endcomment %}

{% endblock %}


